!function(global){"use strict";function ExpProp(e){this.propName=e,this.subProps={},this.expNodes=[],this.attrObserveNodes=[],this.watchs=[]}function ExpNode(e,t,n,i,r,s){this.node=e,this.attrName=t,this.origin=n,this.expMap=i,this.component=r,this.toHTML=s}function AttrObserveNode(e,t){this.directive=e,this.expObj=t}function Watch(e,t,n){this.cbk=e,this.ctrlScope=t,this.segments=n}function ViewModel(){}function Component(e){var t="C_"+im_counter++;this.$__id=t,this.$__state=Component.state.created,this.$view=e,this.$name,this.$parent,this.$__components=[],this.$__expNodes=[],this.$__expPropRoot=new ExpProp,this.$__watcher,this.$template,this.$templateURL,this.$restrict,this.$isolate,this.onCreate,this.onInit,this.onDisplay,this.onDestroy}function View(e,t,n){this.el=e,this.__nodes=n,this.__evMap={},this.__target=t}function tmplExpFilter(e,t,n){return e=e.replace(REG_TMPL_EXP,function(e,i){var i=i.replace(/\s/gm,"");if("CONTENT"===i)return t;if("BINDPROPS"===i){for(var r="",s=Object.keys(n),a=s.length;a--;)r+=n[s[a]].nodeName+'="'+n[s[a]].nodeValue+'" ';return r}var o=n[i]&&n[i].nodeValue;return o||""})}function Directive(e,t){Component.call(this),this.$value=t,this.$name=e,this.$params,this.$filter,this.$final=!1,this.$endTag=null,this.observe}function Filter(e){this.$component=e,this.$value,this.onCreate}function Service(){this.$singleton,this.$host,this.onCreate}function Transition(e,t,n){if(TESTNODE||(TESTNODE=document.createElement("div"),document.body.appendChild(TESTNODE)),n&&n.css===!1)this.$__css=!1;else{TESTNODE.className=e+"-transition",TESTNODE.style.left="-9999px";for(var i=window.getComputedStyle(TESTNODE,null),r=i["transition-duration"].split(","),s=i["transition-delay"].split(","),a=-1,o=r.length;o--;){var l=parseFloat(r[o]),h=parseFloat(s[o]);l+h>a&&(a=l+h)}if(a>0){for(var c=t.$view,o=t.$__expNodes.length;o--;){var p=t.$__expNodes[o];"class"===p.attrName&&(p.origin+=" "+e+"-transition")}c.addClass(e+"-transition"),this.$__longest=a;var u=null;for(var v in TRANSITIONS)if(void 0!==c.el.style[v]){u=TRANSITIONS[v];break}c.el.addEventListener(u,this.__done.bind(this),!1),this.$__css=!0}}this.$__comp=t,this.$__view=c,this.$__hook=n||{},this.$__type=e}function Factory(e){this.types={},this.baseClass=e}function _ComponentFactory(e){Factory.call(this,Component),this.viewProvider=e}function _DirectiveFactory(){Factory.call(this,Directive)}function _FilterFactory(){Factory.call(this,Filter)}function _ServiceFactory(){Factory.call(this,Service)}var Util=new function(){function e(){LOGGER.error("can not fetch remote data of : "+this.url)}function t(){LOGGER.error("load timeout : "+this.url)}function n(){(0===this.status||this.status>=200&&this.status<300||304===this.status)&&(r[this.url]||(r[this.url]=this.responseText),this.cbk&&this.cbk(this.responseText))}this.inherits=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},this.ext=function(e,t){for(var n=Object.keys(t),i=n.length;i--;){var r=n[i];e[r]=t[r]}},this.extProp=function(e,t){for(var n=Object.keys(t),i=n.length;i--;){var r=n[i];t[r]instanceof Function||void 0!==t[r]&&(e[r]=t[r])}},this.extMethod=function(e,t){for(var n=Object.keys(t),i=n.length;i--;){var r=n[i];t[r]instanceof Function&&(e[r]=t[r])}},this.isObject=function(e){return"object"==typeof e&&null!==e},this.isArray=function(e){return e instanceof Array},this.isString=function(e){return"string"==typeof e},this.isUndefined=function(e){return void 0===e},this.isFunction=function(e){return e instanceof Function};var i=document.createElement("div");this.isDOMStr=function(e){return i.innerHTML=e,i.children[0]?!0:!1},this.isDOM="object"==typeof HTMLElement?function(e){return e instanceof HTMLElement}:function(e){return e&&"object"==typeof e&&e.nodeType&&"string"==typeof e.nodeName},this.on=function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):(e.indexOf("on")<0&&(e="on"+e),t.attachEvent(e,n))},this.off=function(e,t,n){t.removeEventListener?t.removeEventListener(e,n,!1):(e.indexOf("on")<0&&(e="on"+e),t.detachEvent(e,n))};var r={};this.loadTemplate=function(i,s,a){if(r[i])return void(s&&s(r[i]));var o=new XMLHttpRequest;o.open("get",i,!0),o.timeout=a||5e3,o.ontimeout=t,o.onerror=e,null===o.onload?o.onload=n:o.onreadystatechange=n,o.cbk=s,o.url=i,o.send(null)}},RAF=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||function(t){return e.setTimeout(function(){t(Date.now())},16.7)}}(self),fallback=Object.observe?!1:!0,observedObjects=[],observedOldObjects=[],observedArys=[],observedOldArys=[],Object_observe=Object.observe||function(e,t){var n={};for(var i in e){var r=e[i];n[i]=r}observedOldObjects.push(e),observedObjects.push({oldVer:n,newVer:e,handler:t})},Object_unobserve=Object.unobserve||function(e,t){var n=observedOldObjects.indexOf(e);n>-1&&(observedObjects.splice(n,1),observedOldObjects.splice(n,1))},Array_observe=Array.observe||function(e,t){var n=[];if(!(e instanceof Array))throw new Error("Array.observe cannot observe non-array");for(var i=e.length;i--;)n.unshift(e[i]);observedOldArys.push(e),observedArys.push({oldVer:n,newVer:e,handler:t})},Array_unobserve=Array.unobserve||function(e,t){var n=observedOldArys.indexOf(e);n>-1&&(observedArys.splice(n,1),observedOldArys.splice(n,1))};fallback&&function e(){RAF(function(){for(var t=observedObjects.length;t--;){var n=observedObjects[t],i=n.oldVer,r=n.newVer,s=n.handler,a=[];for(var o in i){if(void 0===r[o]){var l={};l.name=o,l.oldValue=i[o],l.object=r,l.type="delete",a.push(l)}if(r[o]!==i[o]){var l={};l.name=o,l.oldValue=i[o],l.object=r,l.type="update",a.push(l)}}for(var o in r)if(void 0===i[o]){var l={};l.name=o,l.oldValue=i[o],l.object=r,l.type="add",a.push(l)}if(a.length>0){s(a),n.oldVer={};for(var o in r){var h=r[o];n.oldVer[o]=h}}}for(var t=observedArys.length;t--;){var n=observedArys[t],i=n.oldVer,r=n.newVer,s=n.handler,l=null;if(i.length===r.length){for(var c=i.length;c--;)if(r[c]!==i[c]){l={},l.type="update";break}}else if(i.length>r.length)l={},l.type="delete";else{var l={};l.type="add"}if(l){l.object=r,l.oldValue=i,s([l]),n.oldVer=[];for(var p=0;p<r.length;p++)n.oldVer.push(r[p])}}e()})}();var lexer=function(){function e(){return{subVars:{},words:[],segments:[],brakLength:0}}function t(e,t,r){if(o.test(e)){var s=i(r,t);return c="var",s}return a.test(e)?(c="str",n(t,RegExp.$1)):(c="",e)}function n(e,t){for(var n=!1,i=t,r=1;r<e.length;r++){var s=e[r];if("\\"!==s){if(!n&&s===t)return i+t;i+=s,n=!1}else n=!0,i+=s}}function i(n,r,s,a){for(var c="",p=[],u=-1,v=-1,f=-1,d=a||e(),_=0;_<r.length;_++){var g=r[_];if(p.length>0)if(l.test(g)){var m=e(),$=i(n,r.substr(_),!0,m);_=_+$.length-1;var y=$;o.test($[0])&&h.indexOf(y)<0&&(d.subVars["."+$]=m,h.indexOf(y)<0&&(y=["."+y])),d.words.push(y)}else if("]"===g||")"===g){if(p.pop(),0===p.length){var b=r.substring(u,_+1);c+=b,d.segments.push(b),f=_}d.words.push(g),v=_}else{var w=t(g,r.substr(_),n);_=_+w.length-1,d.words.push(w),v=_}else if(l.test(g)){if(c+=g,"."===g){var y=c.substr(f+1);y=y.replace(/\./,""),y&&(d.segments.push(y),f=_)}}else{if("["!==g&&"("!==g){if("]"!==g&&")"!==g||!s){var y=c.substr(v+1);y&&("."!==y[0]&&h.indexOf(y)<0&&(y=["."+y]),d.words.push(y));var x=c.substr(f+1);return x&&(d.segments.push(x),f=_),!s&&h.indexOf(y)<0&&(n["."+c]=d),c}var y=c;if(y[y.length-1]!==g){/[a-zA-Z0-9$_.]+\[.+\]/.test(c)?(y=y.replace(/[a-zA-Z0-9$_.]+\[.+\]/,""),y&&d.words.push(y)):h.indexOf(y)<0&&d.words.push(["."+y]);var E=y.lastIndexOf(".");E>0&&(y=y.substr(E)),y&&d.segments.push(y),f=_}return v=_,c}p.push(g),u=_,d.brakLength++;var O=c.substr(v+1);if(O){var y=O;h.indexOf(O)<0&&0>v&&(y=["."+O]),d.words.push(y)}d.words.push(g);var C="["===g?"]":")";if(c[_-1]!==C){var T=O.lastIndexOf(".");T>-1?(O=O.substr(T),d.segments.push(O)):d.segments.push(O),f=_}v=_}}var P=c.substr(c.lastIndexOf("]")+1),R=c.substr(c.lastIndexOf(")")+1);if(P&&R){var N=P.length<R.length?P:R,x=c.substr(f+1);d.segments.push(x);var y="["===N[0]||"("===N[0]?N:"."===N[0]?N:"."+N;d.words.length<1&&h.indexOf(y)<0&&(y=[y]),d.words.push(y)}return s||(n["."+c]=d),c}function r(e){for(var t in e){var n=e[t],i=null,a=null,o=t.lastIndexOf(".");if("]"===t[t.length-1]||")"===t[t.length-1]){o=s(t,n.brakLength);var l="]"===t[t.length-1]?"[":"(",h=n.brakLength;n.watchPathWords=[];for(var c=0;c<n.words.length;c++){var p=n.words[c];if(p===l&&--h<1)break;n.watchPathWords.push(p)}}else n.watchPathWords=n.words.concat(),n.watchPathWords.splice(-1,1);i=t.substr(o),n.lastVar="("===i[0]?t:i,Object.keys(n.subVars).length<1&&(a=t.substring(0,o).replace(/\.$/,""),n.watchPath=a);for(var c=n.segments.length;c--;)n.segments[c]=n.segments[c].replace(/^\.|\.$/g,"");r(n.subVars)}}function s(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(("["===i||"("===i)&&--t<1)return n}}var a=/(['"])/,o=/[a-zA-Z$_]/,l=/[a-zA-Z$_0-9.]/,h=["as","instanceof","typeof","in","true","false"],c="",p={};return function(e){if(p[e])return p[e];for(var n=[],i={},s=0;s<e.length;s++){var a=e[s];c="";var o=t(a,e.substr(s),i);switch(s=s+o.length-1,c){case"var":n.push(h.indexOf(o)<0?["."+o]:o);break;case"str":case"":n.push(o)}}return r(i),p[e]={words:n,varTree:i},p[e]}}(),Scanner=new function(){function e(e){var n=[],i=[];t(e,n);for(var r=n.length;r--;){var e=n[r],s=e.nodeValue,a=[],o=0;s.replace(REG_EXP,function(e,t,n){a.push(s.substring(o,n)),a.push(e),o=n+e.length}),a.push(s.substring(o,s.length));for(var l=document.createDocumentFragment(),h=0;h<a.length;h++){var c=document.createTextNode(a[h]);l.appendChild(c)}i.unshift(l)}for(var h=n.length;h--;){var p=n[h];i[h].childNodes.length>1&&p.parentNode&&p.parentNode.replaceChild(i[h],p)}}function t(e,n){if("SCRIPT"!==e.tagName)if(e.attributes||11===e.nodeType){if(e.childNodes.length>0)for(var i=0,r=e.childNodes.length;r>i;i++)t(e.childNodes[i],n)}else if(3===e.nodeType){if(e.nodeValue.replace(/\t|\r|\s/gim,"").length<1)return;n.push(e)}}function n(e){if(e.$restrict)return e;for(var t=e.$parent;t;){if(t.$name&&t.$restrict)return t;t=t.$parent}return null}function i(e,t){if("SCRIPT"!==e.tagName)if(e.attributes||11===e.nodeType){if(e.tagName){var s=e.tagName.toLowerCase();if(ComponentFactory.hasTypeOf(s)){var a=n(t);if(a&&a.$restrict.children){var o=a.$restrict.children.split(",");if(o.indexOf(s)<0)return}var l=ComponentFactory.getRestrictOf(s);if(l&&l.parents){var h=l.parents.split(",");if(h.indexOf(a.$name)<0)return}return void t.createSubComponentOf(s,e)}for(var c=e.attributes,p=c.length;p--;){var u=c[p].name.replace(CMD_PREFIX,""),v=u.indexOf(CMD_PARAM_DELIMITER);if(v>-1&&(u=u.substring(0,v)),DirectiveFactory.hasTypeOf(u)){if(DirectiveFactory.isFinal(u)){{DirectiveFactory.newInstanceOf(u,e,t,c[p].name,c[p].value)}return}if(DirectiveFactory.hasEndTag(u))return[u,c[p].value]}}for(var p=c.length;p--;){var f=c[p],d=f.name,_=f.value;if(REG_CMD.test(d)){var u=d.replace(CMD_PREFIX,""),v=u.indexOf(CMD_PARAM_DELIMITER);if(v>-1&&(u=u.substring(0,v)),DirectiveFactory.hasTypeOf(u)){DirectiveFactory.newInstanceOf(u,e,t,c[p].name,_)}}else REG_EXP.test(_)&&r(_,e,t,d)}}if(e.childNodes.length>0){for(var g=null,m=[],p=0,$=e.childNodes.length;$>p;p++)if(g){m.push(e.childNodes[p]);var y=DirectiveFactory.hasEndTag(g[0]),b=e.childNodes[p].getAttribute&&e.childNodes[p].getAttribute(CMD_PREFIX+y);if(Util.isString(b)){{DirectiveFactory.newInstanceOf(g[0],m,t,CMD_PREFIX+g[0],g[1])}g=null,m=[]}}else g=i(e.childNodes[p],t),g&&m.push(e.childNodes[p]);g&&LOGGER.error("can not find endTag of directive["+CMD_PREFIX+g[0]+"]")}}else if(3===e.nodeType){if(e.nodeValue.replace(/\t|\r|\s/gim,"").length<1)return;r(e.nodeValue,e,t)}}function r(e,t,n,i){var r={},a=!i&&0===e.replace(/\s*/gm,"").indexOf(EXP_START_TAG+EXP2HTML_EXP_TAG);if(a&&(e=e.replace(EXP2HTML_EXP_TAG,"")),e.replace(REG_EXP,function(e,t){var i={},a=1,o=null;FILTER_EXP.test(t)&&(o=s(lexer(RegExp.$1),i,n),a=t.indexOf(FILTER_EXP_START_TAG));var l=t;a>1&&(l=t.substring(0,a));var h=lexer(l);o&&Util.ext(h.varTree,o),r[t]={words:h.words,varTree:h.varTree,filters:i}}),!(Object.keys(r).length<1)){var o=new ExpNode(t,i,e,r,n,a);n.$__expNodes.push(o)}}function s(e,t,n){for(var i=[],r=null,s=!1,a={},o=[],l=e.words,h=0;h<l.length;h++)if(l[h]instanceof Array)for(var c=l[h][0],p=c.split("."),u=1;u<p.length;u++)o.push([p[u]]);else o.push(l[h]);for(var h=0;h<o.length;h++){var c=o[h];switch(c){case":":s=!0,null!==r&&i.push(r),r="";break;case".":s=!1,null!==r&&i.push(r),r="",i=[];break;default:if(c instanceof Array){var v=c[0],f=v.toLowerCase();if(!s&&f&&FilterFactory.hasTypeOf(f))r=null,t[f]=[FilterFactory.newInstanceOf(f,n),i];else{var p=lexer(v);Util.ext(a,p.varTree),i.push(p),r=null}}else{if(!s||!c.replace(/\s+/,""))continue;r+=c.replace(/^['"]|['"]$/g,"")}}}return r&&i.push(r),a}this.scan=function(t,n){for(var r=t.__nodes?t.__nodes:[t.el],s=null,a=[],o=0,l=r.length;l>o;o++)if(e(r[o]),s){a.push(r[o]);var h=DirectiveFactory.hasEndTag(s[0]),c=r[o].getAttribute&&r[o].getAttribute(CMD_PREFIX+h);if(Util.isString(c)){{DirectiveFactory.newInstanceOf(s[0],a,n,CMD_PREFIX+s[0],s[1])}s=null,a=[]}}else s=i(r[o],n),s&&a.push(r[o]);s&&LOGGER.error("can not find endTag of directive["+CMD_PREFIX+s[0]+"]")},this.parseFilters=s},Builder=new function(){function prelink(e){for(var t=e.$__expNodes.length;t--;){var n=e.$__expNodes[t];for(var i in n.expMap){var r=n.expMap[i],s=r.varTree;for(var a in s){var o=s[a];buildExpModel(e,o,n)}}}for(var t=e.$__components.length;t--;){var l=e.$__components[t];l instanceof Directive||(l.init(),l.display())}for(var t=e.$__components.length;t--;){var l=e.$__components[t];l instanceof Directive&&l.init()}}function buildExpModel(e,t,n){for(var i in t.subVars){var r=t.subVars[i];buildExpModel(e,r,n)}for(var s=walkPropTree(e.$__expPropRoot.subProps,t.segments[0],n),a=1;a<t.segments.length;a++)s=walkPropTree(s.subProps,t.segments[a],n)}function walkPropTree(e,t,n){var i=e[t];return i||(i=e[t]=new ExpProp(t)),n instanceof ExpNode?i.expNodes.indexOf(n)<0&&i.expNodes.push(n):n instanceof AttrObserveNode?i.attrObserveNodes.indexOf(n)<0&&i.attrObserveNodes.push(n):n instanceof Watch&&i.watchs.indexOf(n)<0&&i.watchs.push(n),e[t]}function observerProp(e,t,n){function i(e){n.$__state!==Component.state.suspend&&null!==n.$__state&&changeHandler(e)}var r=Util.isArray(e),s=Util.isObject(e);if(e&&(r||s)){if(e.$__impex__observer){var a=t.join(".");if(e.$__impex__propChains[a]){for(var o=e.$__impex__propChains[a],l=o.length;l--;)if(o[l][1]===n)return;return void o.push([t,n])}return void(e.$__impex__propChains[t.join(".")]=[[t,n]])}if(e.$__impex__observer=i,e.$__impex__propChains={},e.$__impex__propChains[t.join(".")]=[[t,n]],r)e.$__impex__oldVal=e.concat(),Array_observe(e,i);else if(s){if(Util.isDOM(e))return;Object_observe(e,i)}for(var h=Object.keys(e),l=h.length;l--;){var a=h[l];if(0!==a.indexOf("$")){var c=t.concat();c.push(a),observerProp(e[a],c,n)}}}}function changeHandler(e){if(!Util.isString(e))for(var t=e.length;t--;){var n=e[t],i=n.name;if(!i||0!==i.indexOf("$")){var r=n.object[i],s=n.oldValue;Util.isArray(n.object)&&(r=n.object,s=n.object.$__impex__oldVal);for(var a=n.object.$__impex__propChains,o=Object.keys(a),l=o.length;l--;)for(var h=o[l],c=a[h],p=c.length;p--;){var u=c[p][0],v=c[p][1],f=u.concat();i&&!Util.isArray(n.object)&&f.push(i),__propStr=null,__lastMatch=void 0,recurRender(v,f,n.type,r,s,0,v),v.$__watcher instanceof Function&&v.$__watcher(n.type,r,s,f),observerProp(r,f,v)}if(!Util.isArray(n.object)&&Util.isArray(n.oldValue))Array_unobserve(n.oldValue,n.oldValue.$__impex__observer);else{if(Util.isArray(n.object))return void(n.object.$__impex__oldVal=n.object.concat());if(Util.isObject(n.oldValue)){var d=n.oldValue.$__impex__observer;d&&(Object_unobserve(n.oldValue,d),n.oldValue.$__impex__observer=null,n.oldValue.$__impex__propChains=null)}}}}}function rerender(e,t,n,i,r){for(var s,a=e.$__expPropRoot.subProps,o=!1,l=0;l<t.length;l++){var h=t[l];if(sqbExp.test(Object.keys(a).join(","))){o=!0;break}{if(!a[h])break;s=a[h],a=a[h].subProps}}if(s){var c=[];if(o)for(var p=t.length-l-1,u=Object.keys(s.subProps),l=u.length;l--;){var v=u[l];("["===v[0]||v===h)&&findMatchProps(s.subProps[v],p,c)}else{if(l<t.length)return;c.push(s)}for(var f=[],l=c.length;l--;){Renderer.renderExpNode(c[l].expNodes);for(var d=c[l].attrObserveNodes.length;d--;){var _=c[l].attrObserveNodes[d],g=Renderer.evalExp(_.directive,_.expObj);_.directive.observe(g)}for(var d=c[l].watchs.length;d--;){var m=c[l].watchs[d];if(!(m.segments.length<t.length||f.indexOf(m)>-1)){for(var $=!0,v=0;v<m.segments.length&&t[v];v++)if("["!==m.segments[v][0]&&"["!==t[v][0]&&m.segments[v]!==t[v]){$=!1;break}if($){var y=i,b=r;if(m.segments.length>t.length){for(var w=m.segments.slice(v),x="$var",v=0;v<w.length;v++){var E=w[v];x+="["===E[0]?E:"."+E}try{y=new Function("$var","return "+x)(i),b=new Function("$var","return "+x)(r)}catch(O){LOGGER.debug("error on parse watch params"),y=null}}m.cbk&&m.cbk.call(m.ctrlScope,n,y,b,t),f.push(m)}}}}}}function findMatchProps(e,t,n){if(1>t)return void n.push(e);for(var i in e.subProps)findMatchProps(e.subProps[i],t-1,n)}function recurRender(component,propChain,changeType,newVal,oldVal,depth,topComp){var toRender=!0;if(depth>0){if(!__propStr){__propStr="";for(var k=0;k<propChain.length;k++){var seg=propChain[k];__propStr+="["===seg[0]?seg:"."+seg}}var prop=void 0;try{prop=eval('impex.__components["'+component.$__id+'"]'+__propStr)}catch(e){}Util.isUndefined(prop)?__lastMatch&&__lastMatch!==topComp&&(toRender=!1):(__lastMatch=component,toRender=!1)}if(toRender&&rerender(component,propChain,changeType,newVal,oldVal),component.$isolate)for(var pc0=propChain[0],i=component.$isolate.length;i--;){var k=component.$isolate[i];if(k.indexOf(".")>0){for(var kc=k.split("."),matchAll=!0,kci=0;kci<kc.length;kci++)kc[kci]!==propChain[kci]&&(matchAll=!1);if(matchAll)return}else if(k===pc0)return}for(var j=component.$__components.length;j--;){var subCtrlr=component.$__components[j];recurRender(subCtrlr,propChain,changeType,newVal,oldVal,depth+1,topComp)}}this.buildExpModel=buildExpModel,this.build=function(e){prelink(e),observerProp(e,[],e)};var __propStr=null,__lastMatch=void 0,sqbExp=/(^\[)|(,\[)/},Renderer=new function(){function renderExpNode(e){for(var t={},n=e.length;n--;){var i=e[n];if(3===i.node.nodeType||DOC_BODY.contains(i.node)||i.toHTML){var r=null;if(t[i.origin]&&t[i.origin].comp===i.component?r=t[i.origin].val:(r=calcExp(i.component,i.origin,i.expMap),t[i.origin]={comp:i.component,val:r}),i.toHTML){var s=renderHTML(i,r,i.node,i.component);if(s)continue}null!==r&&updateDOM(i.node,i.attrName,r)}}}function updateDOM(e,t,n){if(e.setAttribute){e.setAttribute(t,n);var i=propMap[t];i&&i.indexOf(e.tagName)>-1&&(e[t]=n)}else e.nodeValue=n}function clone(e,t){if(null===e)return null;var n=e;if(e instanceof Array){n=e.concat();for(var i=n.length;i--;)n[i]=clone(n[i],t)}else if(Util.isObject(e)){n={};var r=Object.keys(e);if(r.length>0)for(var s=!e.$origin,i=r.length;i--;){{var a=r[i];e[a]}0!==a.indexOf("$__impex__")&&(n[a]="object"==typeof e[a]?clone(e[a],s):e[a])}t!==!1&&(n.$origin=e)}return n}function calcExp(e,t,n){var i={};for(var r in n){var s=n[r],a=evalExp(e,s),o=s.filters;if(Object.keys(o).length>0){a&&Util.isObject(a)&&(a=clone(a,0));for(var l in o){for(var h=o[l][0],c=o[l][1],p=[],u=c.length;u--;){var v=c[u];v.varTree&&v.words&&(v=Renderer.evalExp(e,v)),p[u]=v}h.$value=a,a=h.to.apply(h,p)}}i[r]=void 0===a?"":a}for(var l in i)t=t.replace(EXP_START_TAG+l+EXP_END_TAG,i[l]);return t}function evalExp(component,expObj){var evalExp=getExpEvalStr(component,expObj),rs="";try{rs=eval(evalExp)}catch(e){LOGGER.debug(e.message+' when eval "'+evalExp+'"')}return rs}function getExpEvalStr(e,t){var n=t.varTree,i={};for(var r in n){var s=n[r],a=buildVarPath(e,s,r);i[r]=a}var o=joinExpStr(t.words,i);return o}function joinExpStr(e,t){for(var n="",i=0;i<e.length;i++){var r=e[i];n+=r instanceof Array?t[r[0]]:r}return n}function keyWordsMapping(e,t){return"this"===e?t.__getPath():void 0}function buildVarPath(e,t,n){var i={};for(var r in t.subVars){var s=t.subVars[r],a=buildVarPath(e,s,r);i[r]=a}for(var o=!1,l="",h=0;h<t.words.length;h++){var c=t.words[h];if(c instanceof Array){var p=keyWordsMapping(t.segments[0],e);if(p){o=!0;var u=new RegExp("^\\."+t.segments[0]);l+=c[0].replace(u,p)}else l+=i[c[0]]||c[0]}else l+=c}var v="";if(t.watchPath)v=t.watchPath;else for(var h=0;h<t.watchPathWords.length;h++){var c=t.watchPathWords[h];v+=c instanceof Array?i[c[0]]||c[0]:c}return e=v?varInCtrlScope(e,v):varInCtrlScope(e,l),o?l:(e?e.__getPath():"self")+l}function varInCtrlScope(e,t){for(var n=e;n;){if(void 0!==getVarByPath(t,n.__getPath()))return n;n=n.$parent}}function getVarByPath(path,mPath){var varExp=mPath+path,rs=void 0;try{rs=eval(varExp.replace(/^\./,""))}catch(e){}return rs}function renderHTML(e,t,n,i){if(e.__lastVal!==t&&3==n.nodeType){var r=new View(null,null,[n]);if(Util.isUndefined(e.__lastVal)){var s=ViewManager.createPlaceholder("-- [html] placeholder --");ViewManager.insertBefore(s,r),e.__lastVal=t,e.__placeholder=s}e.__lastComp&&(e.__lastComp.destroy(),r=ViewManager.createPlaceholder(""),ViewManager.insertAfter(r,e.__placeholder)),Util.isDOMStr(t)||(t=t.replace(/</gm,"&lt;").replace(/>/gm,"&gt;"));var a=i.createSubComponent(t,r);return a.init(),a.display(),e.__lastComp=a,e.__lastVal=t,!0}}this.render=function(e){renderExpNode(e.$__expNodes);for(var t=e.$__components.length;t--;)Renderer.render(e.$__components[t])},this.renderExpNode=renderExpNode;var propMap={value:["INPUT"]};this.evalExp=evalExp,this.getExpEvalStr=getExpEvalStr};ViewModel.prototype={data:function(path,val){var expObj=lexer(path),evalStr=Renderer.getExpEvalStr(this,expObj);if(arguments.length>1){Util.isObject(val)||Util.isArray(val)?val=JSON.stringify(val):Util.isString(val)&&(val='"'+val.replace(/\r\n|\n/gm,"\\n").replace(/"/gm,'\\"')+'"');try{eval(evalStr+"= "+val)}catch(e){LOGGER.debug(e.message+"eval error on data("+evalStr+"= "+val+")")}return this}try{return eval(evalStr)}catch(e){LOGGER.debug(e.message+"eval error on data("+evalStr+")")}},closest:function(e){var t=lexer(e),n=Renderer.getExpEvalStr(this,t);return n.replace(/^impex\.__components\["(C_[0-9]+)"\]/,""),impex.__components[RegExp.$1]}},Component.state={created:"created",inited:"inited",displayed:"displayed",suspend:"suspend"},Util.inherits(Component,ViewModel),Util.ext(Component.prototype,{on:function(e,t,n){this.$view.__on(this,e,t,n)},off:function(e,t){this.$view.__off(this,e,t)},find:function(e,t,n){e=e.toLowerCase();for(var i=[],r=this.$__components.length;r--;){var s=this.$__components[r];if("*"===e||s.$name===e){var a=!0;if(t)for(var o in t)if(s[o]!==t[o]){a=!1;break}a&&i.push(s)}if(n&&s.$__components.length>0){var l=s.find(e,t,!0);i&&(i=i.concat(l))}}return i},watch:function(e,t){if("*"===e)this.$__watcher=t;else{var n=lexer(e),i=Object.keys(n.varTree);if(i.length<1)return;if(i.length>1)return void LOGGER.warn("error on parsing watch expression["+e+"], only one property can be watched at the same time");var r=n.varTree[i[0]],s=new Watch(t,this,r.segments);Builder.buildExpModel(this,r,s)}return this},add:function(e){this.$__components.push(e),e.$parent=this},createSubComponentOf:function(e,t){var n=ComponentFactory.newInstanceOf(e,t.__nodes?t.__nodes[0]:t);return this.$__components.push(n),n.$parent=this,n},createSubComponent:function(e,t){var n=ComponentFactory.newInstance(e,t&&t.__nodes[0]);return this.$__components.push(n),n.$parent=this,n},init:function(){if(this.$__state===Component.state.created){if(impex.__components[this.$__id]=this,this.$templateURL){var e=this;Util.loadTemplate(this.$templateURL,function(t){var n=e.$view.__init(t,e);n!==!1&&(e.__init(t),e.display())})}else{if(this.$template){var t=this.$view.__init(this.$template,this);if(t===!1)return}this.__init(this.$template)}return this}},__init:function(e){Scanner.scan(this.$view,this),LOGGER.log(this,"inited");var t=null;return this.onInit&&(t=this.onInit(e)),t===!1?void this.destroy():void(this.$__state=Component.state.inited)},display:function(){(this.$__state===Component.state.inited||this.$__state===Component.state.suspend)&&(this.$view.__display(),this.$__suspendParent?(this.$__suspendParent.add(this),this.$__suspendParent=null):(Renderer.render(this),Builder.build(this)),this.$__state=Component.state.displayed,LOGGER.log(this,"displayed"),this.onDisplay&&this.onDisplay())},destroy:function(){if(null!==this.$__state){if(LOGGER.log(this,"destroy"),this.$parent){var e=this.$parent.$__components.indexOf(this);e>-1&&this.$parent.$__components.splice(e,1),this.$parent=null}for(this.$view.__destroy(this);this.$__components.length>0;)this.$__components[0].destroy();if(this.$view=this.$__components=this.$__expNodes=this.$__expPropRoot=null,this.onDestroy&&this.onDestroy(),!CACHEABLE||!this.$name||this instanceof Directive)this.$__impex__observer=this.$__impex__propChains=this.$__state=this.$__id=this.$templateURL=this.$template=this.$restrict=this.$isolate=this.onCreate=this.onInit=this.onDisplay=this.onSuspend=this.onDestroy=null;else{var t=im_compCache[this.$name];t||(t=im_compCache[this.$name]=[]),this.$__state=Component.state.created,this.$__components=[],this.$__expNodes=[],this.$__expPropRoot=new ExpProp,t.push(this)}impex.__components[this.$__id]=null,delete impex.__components[this.$__id]}},suspend:function(e){if(this instanceof Directive||this.$__state===Component.state.displayed){if(LOGGER.log(this,"suspend"),this.$parent){var t=this.$parent.$__components.indexOf(this);t>-1&&this.$parent.$__components.splice(t,1),this.$__suspendParent=this.$parent,this.$parent=null}this.$view.__suspend(this,e===!1?!1:!0),this.onSuspend&&this.onSuspend(),this.$__state=Component.state.suspend}},__getPath:function(){return'impex.__components["'+this.$__id+'"]'}}),View.prototype={__init:function(e,t){var n=this.__target.attributes,i=this.__target.innerHTML,r=tmplExpFilter(e,i,n),s=DOMViewProvider.compile(r);if(!s||s.length<1)return LOGGER.warn('invalid template "'+e+'" of component['+t.$name+"]"),!1;if(this.__nodes=s,this.el=1===s.length&&1===s[0].nodeType?s[0]:null,n)for(var a=n.length;a--;){var o=n[a].name.toLowerCase();o.indexOf("-")>-1&&(o=o.replace(/-[a-z0-9]/g,function(e){return e[1].toUpperCase()}));var l=n[a].value;t[o]=l}},__display:function(){if(this.__target&&this.__target.parentNode&&(!this.el||!this.el.parentNode||1!==this.el.parentNode.nodeType)){var e=null;if(this.__nodes.length>1){e=document.createDocumentFragment();for(var t=0;t<this.__nodes.length;t++)e.appendChild(this.__nodes[t])}else e=this.__nodes[0];this.__target.parentNode.replaceChild(e,this.__target),e=null,this.__target=null}},__destroy:function(e){for(var t in this.__evMap)for(var n=this.__evMap[t],i=n.length;i--;)for(var r=n[i],s=r[1],a=this.__nodes.length;a--;)1===this.__nodes[a].nodeType&&Util.off(t,this.__nodes[a],s);var o=this.__nodes[0].parentNode;if(o){this.__nodes[0].__impex__view&&(this.__nodes[0].__impex__view=null);for(var i=this.__nodes.length;i--;)this.__nodes[i].parentNode&&o.removeChild(this.__nodes[i])}this.__target&&(this.__target.parentNode.removeChild(this.__target),this.__target=null)},__suspend:function(e,t){var n=this.__nodes[0].parentNode;if(n){t&&(this.__target=document.createComment("-- view suspended of ["+(e.$name||"anonymous")+"] --"),n.insertBefore(this.__target,this.__nodes[0]));for(var i=this.__nodes.length;i--;)this.__nodes[i].parentNode&&n.removeChild(this.__nodes[i])}},__on:function(e,t,n,i){if(this.el){var r=n,s=e,a="",o=null,l=function(e){var n=r;if(i instanceof Function&&(n=i.call(s,e,r)),n){if(a!=n){var l=lexer(n),h=Renderer.getExpEvalStr(s,l),c=h.replace("self.$event","$event");o=new Function("$event",c),a=n}try{o(e)}catch(p){LOGGER.debug(p.message+" on event "+t+"("+c+")")}}};Util.on(t,this.el,l),this.__evMap[t]||(this.__evMap[t]=[]),this.__evMap[t].push([n,l])}},__off:function(e,t,n){if(this.el)for(var i=this.__evMap[t],r=i.length;r--;){var s=i[r],a=s[0],o=s[1];a==n&&Util.off(t,this.el,o)}},clone:function(){for(var e=[],t=this.__nodes.length;t--;){var n=this.__nodes[t].cloneNode(!0);e.unshift(n)}var i=new View(1===e.length&&1===e[0].nodeType?e[0]:null,null,e);return i},show:function(){return this.el.style.display="",this},hide:function(){return this.el.style.display="none",this},style:function(e,t){return arguments.length>1?(this.el.style[e]=t,this):this.el.style[e]},attr:function(e,t){return arguments.length>1?(this.el.setAttribute(e,t),this):this.el.getAttribute(e)},removeAttr:function(e){return this.el.removeAttribute(e),this},hasClass:function(e){return this.el.className.indexOf(e)>-1},addClass:function(e){e=e.replace(/\s+/gm," ").replace(/^\s*|\s*$/gm,""),e=e.split(" ");for(var t=this.el.className.split(" "),n="",i=e.length;i--;)t.indexOf(e[i])<0&&(n+=e[i]+" ");return this.el.className+=" "+n,this},removeClass:function(e){e=e.replace(/\s+/gm," ").replace(/^\s*|\s*$/gm,"");var t=e.split(" "),n=this.el.className;if(n){for(var i=t.length;i--;){var r=t[i],s=new RegExp("^"+r+"\\s+|\\s+"+r+"$|\\s+"+r+"\\s+","img");n=n.replace(s,"")}this.el.className=n}return this},toggleClass:function(e){e=e.replace(/\s+/gm," ").replace(/^\s*|\s*$/gm,"");for(var t=e.split(" "),n=!1,i=this.el.className,r=t.length;r--;){var s=t[r];if(i.indexOf(s)<0){n=!0;break}}n?this.addClass(e):this.removeClass(e)}};var DOMViewProvider=new function(){var e=document.createElement("div");this.newInstance=function(t,n){if(""===t)return new View(null,n,[document.createTextNode("")]);if(e.innerHTML=t,!e.childNodes[0])return null;for(var i=[];e.childNodes.length>0;){var r=e.removeChild(e.childNodes[0]);i.push(r)}var s=new View(null,n,i);return s},this.compile=function(t){e.innerHTML=t;for(var n=[];e.childNodes.length>0;){{var i=e.removeChild(e.childNodes[0]);i.nodeName.toLowerCase()}n.push(i)}return n}},ViewManager=new function(){this.$singleton=!0,this.replace=function(e,t){var n=t.__nodes[0],i=e.__nodes[0],r=t.__nodes[0].parentNode,s=i;if(e.__nodes.length>1){s=document.createDocumentFragment();for(var a=0;a<e.__nodes.length;a++)s.appendChild(e.__nodes[a])}if(t.__nodes.length>1){r.insertBefore(s,n);for(var a=t.__nodes.length;a--;)r.removeChild(t.__nodes[a])}else r.replaceChild(s,n)},this.insertBefore=function(e,t){var n=t.__nodes[0],i=e.__nodes[0],r=t.__nodes[0].parentNode,s=i;if(e.__nodes.length>1){s=document.createDocumentFragment();for(var a=0;a<e.__nodes.length;a++)s.appendChild(e.__nodes[a])}r&&r.insertBefore(s,n)},this.insertAfter=function(e,t){var n=t.__nodes[0],i=e.__nodes[0],r=t.__nodes[0].parentNode,s=r.lastChild,a=i;if(e.__nodes.length>1){a=document.createDocumentFragment();for(var o=0;o<e.__nodes.length;o++)a.appendChild(e.__nodes[o])}if(s==n)r.appendChild(a);else{var l=t.__nodes[t.__nodes.length-1].nextSibling;r.insertBefore(a,l)}},this.append=function(e,t){var n=e.__nodes[0],i=t.__nodes[0],r=n;if(e.__nodes.length>1){r=document.createDocumentFragment();for(var s=0;s<e.__nodes.length;s++)r.appendChild(e.__nodes[s])}i.appendChild(r)},this.prepend=function(e,t){var n=e.__nodes[0],i=t.__nodes[0],r=n;if(e.__nodes.length>1){r=document.createDocumentFragment();for(var s=0;s<e.__nodes.length;s++)r.appendChild(e.__nodes[s])}i.insertBefore(r,i.firstChild)},this.createPlaceholder=function(e){return new View(null,null,[document.createComment(e)])}};Util.inherits(Directive,Component),Util.ext(Directive.prototype,{init:function(){impex.__components[this.$__id]=this;var e={},t=this;this.$value.replace(REG_EXP,function(n,i){var r=lexer(i),s=Renderer.evalExp(t.$parent,r);e[i]={val:s}});var n=this.$value;for(var i in e)n=n.replace(EXP_START_TAG+i+EXP_END_TAG,e[i].val);if(this.$view&&(this.$view.removeAttr(this.$name),this.$endTag)){var r=this.$view.__nodes[this.$view.__nodes.length-1];r.removeAttribute(CMD_PREFIX+this.$endTag)}if(this.$value=n,LOGGER.log(this,"inited"),this.onInit&&this.onInit(),this.$__state=Component.state.inited,this.observe){var s=lexer(n);for(var a in s.varTree){var o=s.varTree[a],l=new AttrObserveNode(this,s);this.$parent&&Builder.buildExpModel(this.$parent,o,l)}var h=Renderer.evalExp(this.$parent,s);this.observe(h)}}}),Filter.prototype={
to:function(){return null}};var TRANSITIONS={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"mozTransitionend",WebkitTransition:"webkitTransitionEnd"},TESTNODE;Transition.prototype={enter:function(){this.$__start="enter",this.$__css&&this.$__view.addClass(this.$__type+"-enter"),this.$__comp.enter&&this.$__comp.enter(),this.$__hook.enter&&this.$__hook.enter.call(this.$__comp,this.__enterDone.bind(this)),this.$__css&&(this.$__view.el.offsetHeight,this.$__view.removeClass(this.$__type+"-enter"))},__enterDone:function(){},leave:function(){this.$__start="leave",this.$__css&&this.$__view.addClass(this.$__type+"-leave"),this.$__hook.leave&&(this.__leaveDone.$__trans=this,this.$__hook.leave.call(this.$__comp,this.__leaveDone.bind(this)))},__leaveDone:function(){this.$__comp.leave&&this.$__comp.leave()},__done:function(e){if(!(e.elapsedTime<this.$__longest)&&this.$__start){switch(this.$__start){case"enter":this.__enterDone();break;case"leave":this.__leaveDone()}this.$__start="",this.$__view.removeClass(this.$__type+"-leave")}}},Factory.prototype={register:function(e,t,n){if(e=e.toLowerCase(),this.baseClass===Component||this.baseClass===Directive)for(var i=Object.keys(t),r=BUILD_IN_PROPS.length;r--;)if(i.indexOf(BUILD_IN_PROPS[r])>-1)return void LOGGER.error("attempt to overwrite build-in property["+BUILD_IN_PROPS[r]+"] of Component["+e+"]");var s=new Function("clazz","var args=[];for(var i=1;i<arguments.length;i++)args.push(arguments[i]);clazz.apply(this,args)"),a={};Util.extProp(a,t),Util.inherits(s,this.baseClass),Util.extMethod(s.prototype,t),this.types[e]={clazz:s,props:a,services:n}},hasTypeOf:function(e){return e in this.types}},Util.inherits(_ComponentFactory,Factory),Util.ext(_ComponentFactory.prototype,{getRestrictOf:function(e){return this.types[e].props.$restrict},newInstance:function(e){var t=null;if(2===arguments.length){var n=arguments[0],i=arguments[1];t=n,Util.isString(n)?t=this.viewProvider.newInstance(n,i):t.__target=i}else t=e,Util.isDOM(e)&&(t=new View(e,null,[e]));var r=new this.baseClass(t),s=arguments[2];if(s){for(var a=Object.keys(s),o=BUILD_IN_PROPS.length;o--;)if(a.indexOf(BUILD_IN_PROPS[o])>-1)return void LOGGER.error("attempt to overwrite build-in property["+BUILD_IN_PROPS[o]+"] of Component");Util.ext(r,s)}return r},newInstanceOf:function(e,t){if(!this.types[e])return null;var n=null,i=im_compCache[e];if(CACHEABLE&&i&&i.length>0?n=i.pop():(n=new this.types[e].clazz(this.baseClass),Util.extProp(n,this.types[e].props),n.$name=e),n.$view=new View(null,t),n.onCreate){var r=null;if(this.types[e].services){r=[];for(var s=0;s<this.types[e].services.length;s++){var a=ServiceFactory.newInstanceOf(this.types[e].services[s],n);r.push(a)}}r?n.onCreate.apply(n,r):n.onCreate()}return n}});var ComponentFactory=new _ComponentFactory(DOMViewProvider);Util.inherits(_DirectiveFactory,Factory),Util.ext(_DirectiveFactory.prototype,{isFinal:function(e){return!!this.types[e].props.$final},hasEndTag:function(e){return this.types[e].props.$endTag},newInstanceOf:function(e,t,n,i,r){if(!this.types[e])return null;var s=null,a=null,o=i.indexOf(CMD_PARAM_DELIMITER);if(o>-1){s=i.substr(o+1);var l=s.indexOf(CMD_FILTER_DELIMITER);l>-1&&(a=s.substr(l+1),s=s.substring(0,l)),s=s.split(CMD_PARAM_DELIMITER)}var h=new this.types[e].clazz(this.baseClass,i,r,n);if(Util.extProp(h,this.types[e].props),t.__impex__view)h.$view=t.__impex__view;else{var c=t,p=[t];Util.isArray(t)&&(c=t[0],p=t),h.$view=new View(c,null,p),t.__impex__view=h.$view}if(s&&(h.$params=s),a&&(h.$filter=a),n.add(h),h.onCreate){var u=null;if(this.types[e].services){u=[];for(var o=0;o<this.types[e].services.length;o++){var v=ServiceFactory.newInstanceOf(this.types[e].services[o],h);u.push(v)}}u?h.onCreate.apply(h,u):h.onCreate()}return h}});var DirectiveFactory=new _DirectiveFactory;Util.inherits(_FilterFactory,Factory),Util.ext(_FilterFactory.prototype,{newInstanceOf:function(e,t){if(!this.types[e])return null;var n=new this.types[e].clazz(this.baseClass,t);if(Util.extProp(n,this.types[e].props),n.onCreate){var i=null;if(this.types[e].services){i=[];for(var r=0;r<this.types[e].services.length;r++){var s=ServiceFactory.newInstanceOf(this.types[e].services[r],n);i.push(s)}}i?n.onCreate.apply(n,i):n.onCreate()}return n}});var FilterFactory=new _FilterFactory;Util.inherits(_ServiceFactory,Factory),Util.ext(_ServiceFactory.prototype,{newInstanceOf:function(e,t){if(e=e.toLowerCase(),!this.types[e])return null;var n=null;if(this.types[e].props.$singleton?(this.types[e].singleton||(this.types[e].singleton=new this.types[e].clazz(this.baseClass)),n=this.types[e].singleton):(n=new this.types[e].clazz(this.baseClass),Util.extProp(n,this.types[e].props)),n.$host=t,n.onCreate){var i=null;if(this.types[e].services){i=[];for(var r=0;r<this.types[e].services.length;r++){var s=ServiceFactory.newInstanceOf(this.types[e].services[r],n);i.push(s)}}i?n.onCreate.apply(n,i):n.onCreate()}return n}});var ServiceFactory=new _ServiceFactory,TransitionFactory={hooks:{},register:function(e,t){this.hooks[e]=t},transitions:{},get:function(e,t){var n=new Transition(e,t,this.hooks[e]);return n}},CMD_PREFIX="x-",CMD_PARAM_DELIMITER=":",CMD_FILTER_DELIMITER=".",EXP_START_TAG="{{",EXP_END_TAG="}}",REG_EXP=/\{\{(.*?)\}\}/gim,REG_TMPL_EXP=/\{\{=(.*?)\}\}/gim,REG_CMD=/x-.*/,EXP2HTML_EXP_TAG="#",EXP2HTML_START_EXP=/^\s*#/,FILTER_EXP=/=>\s*(.+?)$/,FILTER_EXP_START_TAG="=>",LOGGER=new function(){this.log=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}},CACHEABLE=!1,im_compCache={},im_counter=0,DOC_BODY=null,BUILD_IN_PROPS=["data","closest","add","on","off","find","watch","init","display","destroy","suspend"],impex=new function(){function e(e){var n=e;do{if(t.indexOf(n)>-1)return!0;n=n.parentNode}while(n);return!1}this.version={v:[0,8,0],state:"beta",toString:function(){return impex.version.v.join(".")+" "+impex.version.state}},this.website="http://mrsoya.github.io/impex",this.config=function(e){var t=e.delimiters||[];EXP_START_TAG=t[0]||"{{",EXP_END_TAG=t[1]||"}}",REG_EXP=new RegExp(EXP_START_TAG+"(.*?)"+EXP_END_TAG,"img"),REG_TMPL_EXP=new RegExp(EXP_START_TAG+"=(.*?)"+EXP_END_TAG,"img"),LOGGER=e.logger||new function(){this.log=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}},CACHEABLE=e.cacheable||!1},this.component=function(e,t,n){return t.$template||t.$templateURL?(ComponentFactory.register(e,t,n),this):void LOGGER.error("can not find property '$template' or '$templateURL' of component '"+e+"'")},this.directive=function(e,t,n){return DirectiveFactory.register(e,t,n),this},this.service=function(e,t,n){return ServiceFactory.register(e,t,n),this},this.filter=function(e,t,n){return FilterFactory.register(e,t,n),this},this.transition=function(e,t){return TransitionFactory.register(e,t),this},this.render=function(n,i,r){DOC_BODY||(DOC_BODY=document.body);var s=n.tagName.toLowerCase();if(e(n))return void LOGGER.warn("element ["+s+"] has been rendered");var a=ComponentFactory.newInstanceOf(s,n);if(a||(t.push(n),a=ComponentFactory.newInstance(n,null,i)),a.onCreate){var o=null;if(Util.isArray(r)){o=[];for(var l=0;l<r.length;l++){var h=ServiceFactory.newInstanceOf(r[l],a);o.push(h)}}o?a.onCreate.apply(a,o):a.onCreate()}return a.init(),a.display(),a};var t=[];this.__components={},this.findAll=function(e,t){e=e.toLowerCase();for(var n=[],i=Object.keys(this.__components),r=i.length;r--;){var s=this.__components[i[r]];if("*"===e||s.$name===e){var a=!0;if(t)for(var o in t)if(s[o]!==t[o]){a=!1;break}a&&n.push(s)}}return n}};impex.service("ViewManager",ViewManager),impex.service("ComponentManager",{hasTypeOf:function(e){return ComponentFactory.hasTypeOf(e)}}),impex.service("Transitions",new function(){this.get=function(e,t){return e=e||"x",TransitionFactory.get(e,t)}}),!function(e){function t(e,n,i){for(var r=e.$__expNodes.length;r--;){var s=e.$__expNodes[r];s.node==n&&"class"===s.attrName&&(s.origin=i)}for(var a=e.$__components.length;a--;)t(e.$__components[a],n,i)}function n(){function e(t,n){if(null===t)return null;var i=t;if(t instanceof Array){i=t.concat();for(var r=i.length;r--;)i[r]=e(i[r],n)}else if(Util.isObject(t)){i={};var s=Object.keys(t);if(s.length>0)for(var a=!t.$origin,r=s.length;r--;){{var o=s[r];t[o]}0!==o.indexOf("$__impex__")&&(i[o]="object"==typeof t[o]?e(t[o],a):t[o])}n!==!1&&(i.$origin=t)}return i}this.onCreate=function(e,t){this.$eachExp=/^(.+?)\s+as\s+((?:[a-zA-Z0-9_$]+?\s*,)?\s*[a-zA-Z0-9_$]+?)\s*(?:=>\s*(.+?))?$/,this.$viewManager=e,this.$expInfo=this.parseExp(this.$value),this.$parentComp=this.$parent,this.$__view=this.$view,this.$cache=[],this.$subComponents=[],this.$cacheSize=20;var n=this.$view.attr("transition");null!==n&&(this.$trans=n,this.$ts=t)},this.onInit=function(){if(this.$__state!==Component.state.inited){this.$ds=this.$parent.data(this.$expInfo.ds),this.$placeholder=this.$viewManager.createPlaceholder("-- directive [each] placeholder --"),this.$viewManager.insertBefore(this.$placeholder,this.$view),this.$ds&&this.build(this.$ds,this.$expInfo.k,this.$expInfo.v),this.destroy();var e=this;this.$parentComp.watch(this.$expInfo.ds,function(t,n,i){if(!e.$ds)return e.$ds=e.$parentComp.data(e.$expInfo.ds),void e.build(e.$ds,e.$expInfo.k,e.$expInfo.v);var r=0,s=0;for(var a in n)n.hasOwnProperty(a)&&0!==a.indexOf("$")&&r++;if(0===r)s=e.$subComponents.length;else for(var a in i)i.hasOwnProperty(a)&&0!==a.indexOf("$")&&s++;e.rebuild(n,r-s,e.$expInfo.k,e.$expInfo.v)})}},this.rebuild=function(e,t,n,i){if(e=this.doFilter(e),-999===t&&(t=e.length-this.$subComponents.length),0>t){var r=this.$subComponents.splice(0,-1*t);if(this.$cache.length<this.$cacheSize){for(var s=r.length;s--;)this.$cache.push(r[s]);for(var s=this.$cache.length;s--;)this.$trans&&!this.$cache[s].$__leaving&&"displayed"===this.$cache[s].$__state?(this.$cache[s].$__leaving=!0,this.$cache[s].$transition.leave()):this.$cache[s].suspend(!1)}else for(var s=r.length;s--;)r[s].destroy()}else if(t>0){for(var r=this.$cache.splice(0,t),s=0;s<r.length;s++)this.$subComponents.push(r[s]),this.$viewManager.insertBefore(r[s].$view,this.$placeholder);for(var a=t-r.length;a--;)this.createSubComp()}var o=Util.isArray(e)?!0:!1,l=0;for(var h in e)if(e.hasOwnProperty(h)&&!(o&&isNaN(h)||0===h.indexOf("$__"))){var c=this.$subComponents[l];c[i]=e[h],c.$index=l++,n&&(c[n]=o?h>>0:h),c.init(),c.display()}},this.createSubComp=function(){var e=this.$parentComp,t=this.$viewManager.createPlaceholder("");this.$viewManager.insertBefore(t,this.$placeholder);var n=this.$__view.clone(),i=e.createSubComponent(n,t);if(this.$subComponents.push(i),this.$trans){var r=this;i.onInit=function(){this.$transition||(this.$transition=r.$ts.get(r.$trans,this))},i.onDisplay=function(){this.$transition.enter()},i.leave=function(){this.suspend(!1),this.$__leaving=!1}}return i},this.doFilter=function(t){if(!this.$filters)return t;var n=this.$filters;if(Object.keys(n).length>0){t&&Util.isObject(t)&&(t=e(t));for(var i in n){for(var r=n[i][0],s=n[i][1],a=[],o=s.length;o--;){var l=s[o];l.varTree&&l.words&&(l=Renderer.evalExp(this.$parentComp,l)),a[o]=l}r.$value=t,t=r.to.apply(r,a)}return t}},this.build=function(e,t,n){var i=Util.isArray(e)?!0:!1,r=0;e=this.doFilter(e);for(var s in e)if(e.hasOwnProperty(s)&&!(i&&isNaN(s)||0===s.indexOf("$__"))){var a=this.createSubComp();a[n]=e[s],a.$index=r++,t&&(a[t]=i?s>>0:s)}for(var o=this.$subComponents.length;o--;)this.$subComponents[o].init(),this.$subComponents[o].display()},this.parseExp=function(e){var t,n,i,r=this;return e.replace(this.$eachExp,function(e,s,a,o){t=s;var l=a.replace(/\s/gm,""),h=l.split(",");if(h.length>1?(n=h[0],i=h[1]):i=h[0],o){var c={},p=Scanner.parseFilters(lexer(o),c,r.$parent);r.$filters=c;for(var u in p)r.$parent.watch(u,function(e,t,n){r.$ds&&r.rebuild(r.$ds,-999,r.$expInfo.k,r.$expInfo.v)})}}),t?{ds:t,k:n,v:i}:void LOGGER.error("invalid each expression : "+e)}}e.directive("ignore",{$final:!0}),e.directive("bind",{onInit:function(){(!this.$params||this.$params.length<1)&&LOGGER.warn("at least one attribute be binded")},observe:function(e){if(this.$params&&!(this.$params.length<1)){var t=null;if(this.$filter){var n=this.closest(this.$filter);n&&(t=n[this.$filter])}if(t){var i=t(e);if(!Util.isUndefined(i)&&!i)return}for(var r=this.$params.length;r--;){var s=this.$params[r];this.$view.attr(s,e)}}}}),e.directive("show",{onCreate:function(e){var t=this.$view.attr("transition");null!==t&&(this.$transition=e.get(t,this)),this.exec(!1)},observe:function(e){e!==this.$lastRs&&(this.$lastRs=e,this.$transition?e?this.$transition.enter():this.$transition.leave():this.exec(e))},enter:function(){this.exec(this.$lastRs)},leave:function(){this.exec(this.$lastRs)},exec:function(e){e?this.$view.show():this.$view.hide()}},["Transitions"]),e.directive("show-start",{$endTag:"show-end",onCreate:function(){this.$view.removeAttr("x-show-start"),this.__init(),this.display()},observe:function(e){e?this.$view.show():this.$view.hide()}}),e.directive("if",{onCreate:function(e,t){this.viewManager=e,this.placeholder=e.createPlaceholder("-- directive [if] placeholder --");var n=this.$view.attr("transition");null!==n&&(this.$transition=t.get(n,this)),this.$lastRs=!1,this.exec(!1)},observe:function(e){(e!==this.$lastRs||this.$view.el.parentNode)&&(this.$lastRs=e,this.$transition?e?this.$transition.enter():this.$transition.leave():this.exec(e))},enter:function(){this.exec(this.$lastRs)},leave:function(){this.exec(this.$lastRs)},exec:function(e){if(e){if(this.$view.el.parentNode)return;this.viewManager.replace(this.$view,this.placeholder)}else{if(!this.$view.el.parentNode)return;this.viewManager.replace(this.placeholder,this.$view)}}},["ViewManager","Transitions"]),e.directive("if-start",{$endTag:"if-end",onCreate:function(e){this.viewManager=e,this.placeholder=e.createPlaceholder("-- directive [if] placeholder --"),this.$view.removeAttr("x-if-start"),this.__init(),this.display()},observe:function(e){if(e){if(this.$view.el.parentNode)return;this.viewManager.replace(this.$view,this.placeholder)}else{if(!this.$view.el.parentNode)return;this.viewManager.replace(this.placeholder,this.$view)}}},["ViewManager"]),e.directive("cloak",{onCreate:function(){var e=this.$view.attr("class");return e?(e=e.replace("x-cloak",""),this.$view.attr("class",e),void t(this.$parent,this.$view.el,e)):void LOGGER.warn("can not find attribute[class] of element["+this.$view.name+"] which directive[cloak] on")}}),e.directive("model",{onCreate:function(){var e=this.$view.el;switch(this.toNum=e.getAttribute("number"),this.debounce=e.getAttribute("debounce")>>0,e.nodeName.toLowerCase()){case"textarea":case"input":var t=this.$view.attr("type");switch(t){case"radio":this.on("click","changeModel($event)");break;case"checkbox":this.on("click","changeModelCheck($event)");break;default:var n=null===document.body.onpropertychange?"propertychange":"input";this.on(n,"changeModel($event)")}break;case"select":var i=e.getAttribute("multiple");null!==i?this.on("change","changeModelSelect($event)"):this.on("change","changeModel($event)")}},changeModelSelect:function(e){for(var t=e.target||e.srcElement,n=(t.value,[]),i=t.options.length;i--;){var r=t.options[i];r.selected&&n.push(r.value)}this.$parent.data(this.$value,n)},changeModelCheck:function(e){var t=e.target||e.srcElement,n=t.value,i=this.$parent.data(this.$value);if(i instanceof Array||(i=[i]),t.checked)i.push(n);else{var r=i.indexOf(n);r>-1&&i.splice(r,1)}this.$parent.data(this.$value,i)},changeModel:function(e){if(this.debounce){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null);var t=this;this.debounceTimer=setTimeout(function(){clearTimeout(t.debounceTimer),t.debounceTimer=null,t.setVal(e)},this.debounce)}else this.setVal(e)},setVal:function(e){var t=(e.target||e.srcElement).value;null!==this.toNum&&(t=parseFloat(t)),this.$parent.data(this.$value,t)}});var i=new n;i.$final=!0,e.directive("each",i,["ViewManager","Transitions"]);var r=new n;r.$endTag="each-end",e.directive("each-start",r,["ViewManager"])}(impex),impex.filter("json",{to:function(){return JSON.stringify(this.$value)}}),impex.filter("filterBy",{to:function(e,t){var n=this.$value;if(!(n instanceof Array))return console.warn("can only filter array"),this.$value;var i=[];if(e instanceof Function)for(var r=n.length;r--;){var s=e.call(this,n[r]);s&&i.unshift(n[r])}else for(var r=n.length;r--;){var a=n[r];t?(!e||a[t].indexOf(e)>-1)&&i.unshift(a):(!e||a.indexOf&&a.indexOf(e)>-1)&&i.unshift(a)}return i}}),impex.filter("limitBy",{to:function(e,t){return this.$value instanceof Array?e?this.$value.splice(t||0,e):this.$value:(console.warn("can only filter array"),this.$value)}}),impex.filter("orderBy",{to:function(e,t){return this.$value instanceof Array?(this.$value.sort(function(t,n){var i=e?t[e]:t,r=e?n[e]:n;return(i+"").localeCompare(r+"")}),"desc"===t&&this.$value.reverse(),this.$value):(console.warn("can only filter array"),this.$value)}}),"object"==typeof module&&"object"==typeof module.exports?module.exports=impex:global.impex=impex}(window||this);