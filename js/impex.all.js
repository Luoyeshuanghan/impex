!function(global){"use strict";function ExpProp(e){this.propName=e,this.subProps={},this.expNodes=[],this.attrObserveNodes=[],this.watchs=[]}function ExpNode(e,t,n,r,i,s){this.node=e,this.attrName=t,this.origin=n,this.expMap=r,this.component=i,this.toHTML=s}function AttrObserveNode(e,t){this.directive=e,this.expObj=t}function Watch(e,t,n){this.cbk=e,this.ctrlScope=t,this.segments=n}function ViewModel(){}function Component(e){var t="C_"+Object.keys(impex.__components).length;impex.__components[t]=this,this.$__id=t,this.$__state=Component.state.created,this.$view=e,this.$name,this.$parent,this.$__components=[],this.$__directives=[],this.$__expNodes=[],this.$__expPropRoot=new ExpProp,this.$template,this.$templateURL,this.$restrict,this.onCreate,this.onInit,this.onDisplay,this.onDestroy}function View(e,t){this.elements=e,this.__evMap={},this.__target=t}function tmplExpFilter(e,t,n){return e=e.replace(REG_TMPL_EXP,function(e,r){var r=r.replace(/\s/gm,"");if("CONTENT"===r)return t;if("BINDPROPS"===r){for(var i="",s=Object.keys(n),a=s.length;a--;)i+=n[s[a]].nodeName+'="'+n[s[a]].nodeValue+'" ';return i}var o=n[r]&&n[r].nodeValue;return o||""})}function Directive(e,t){Component.call(this),this.$value=t,this.$name=e,this.$params,this.$filter,this.$final=!1,this.$endTag=null,this.observe}function Filter(e){this.$component=e,this.$value,this.onCreate}function Service(){this.$singleton,this.$host,this.onCreate}function Factory(e){this.types={},this.instances=[],this.baseClass=e}function _ComponentFactory(e){Factory.call(this,Component),this.viewProvider=e}function _DirectiveFactory(){Factory.call(this,Directive)}function _FilterFactory(){Factory.call(this,Filter)}function _ServiceFactory(){Factory.call(this,Service)}var Util=new function(){function e(){LOGGER.error("can not fetch remote data of : "+this.url)}function t(){LOGGER.error("load timeout : "+this.url)}function n(){(0===this.status||this.status>=200&&this.status<300||304===this.status)&&(i[this.url]||(i[this.url]=this.responseText),this.cbk&&this.cbk(this.responseText))}this.inherits=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},this.ext=function(e,t){for(var n=Object.keys(t),r=n.length;r--;){var i=n[r];e[i]=t[i]}},this.extProp=function(e,t){for(var n=Object.keys(t),r=n.length;r--;){var i=n[r];t[i]instanceof Function||void 0!==t[i]&&(e[i]=t[i])}},this.extMethod=function(e,t){for(var n=Object.keys(t),r=n.length;r--;){var i=n[r];t[i]instanceof Function&&(e[i]=t[i])}},this.isObject=function(e){return"object"==typeof e&&null!==e},this.isArray=function(e){return e instanceof Array},this.isString=function(e){return"string"==typeof e},this.isUndefined=function(e){return void 0===e},this.isFunction=function(e){return e instanceof Function};var r=document.createElement("div");this.isDOMStr=function(e){return r.innerHTML=e,r.children[0]?!0:!1},this.isDOM="object"==typeof HTMLElement?function(e){return e instanceof HTMLElement}:function(e){return e&&"object"==typeof e&&e.nodeType&&"string"==typeof e.nodeName},this.on=function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):(e.indexOf("on")<0&&(e="on"+e),t.attachEvent(e,n))},this.off=function(e,t,n){t.removeEventListener?t.removeEventListener(e,n,!1):(e.indexOf("on")<0&&(e="on"+e),t.detachEvent(e,n))};var i={};this.loadTemplate=function(r,s,a){if(i[r])return void(s&&s(i[r]));var o=new XMLHttpRequest;o.open("get",r,!0),o.timeout=a||5e3,o.ontimeout=t,o.onerror=e,null===o.onload?o.onload=n:o.onreadystatechange=n,o.cbk=s,o.url=r,o.send(null)}},RAF=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||function(t){return e.setTimeout(function(){t(Date.now())},16.7)}}(self),fallback=Object.observe?!1:!0,observedObjects=[],observedOldObjects=[],observedArys=[],observedOldArys=[],Object_observe=Object.observe||function(e,t){var n={};for(var r in e){var i=e[r];n[r]=i}observedOldObjects.push(e),observedObjects.push({oldVer:n,newVer:e,handler:t})},Object_unobserve=Object.unobserve||function(e,t){var n=observedOldObjects.indexOf(e);n>-1&&(observedObjects.splice(n,1),observedOldObjects.splice(n,1))},Array_observe=Array.observe||function(e,t){var n=[];if(!(e instanceof Array))throw new Error("Array.observe cannot observe non-array");for(var r=e.length;r--;)n.unshift(e[r]);observedOldArys.push(e),observedArys.push({oldVer:n,newVer:e,handler:t})},Array_unobserve=Array.unobserve||function(e,t){var n=observedOldArys.indexOf(e);n>-1&&(observedArys.splice(n,1),observedOldArys.splice(n,1))};fallback&&function e(){RAF(function(){for(var t=observedObjects.length;t--;){var n=observedObjects[t],r=n.oldVer,i=n.newVer,s=n.handler,a=[];for(var o in r){if(void 0===i[o]){var l={};l.name=o,l.oldValue=r[o],l.object=i,l.type="delete",a.push(l)}if(i[o]!==r[o]){var l={};l.name=o,l.oldValue=r[o],l.object=i,l.type="update",a.push(l)}}for(var o in i)if(void 0===r[o]){var l={};l.name=o,l.oldValue=r[o],l.object=i,l.type="add",a.push(l)}if(a.length>0){s(a),n.oldVer={};for(var o in i){var h=i[o];n.oldVer[o]=h}}}for(var t=observedArys.length;t--;){var n=observedArys[t],r=n.oldVer,i=n.newVer,s=n.handler,l=null;if(r.length===i.length){for(var c=r.length;c--;)if(i[c]!==r[c]){l={},l.type="update";break}}else if(r.length>i.length)l={},l.type="delete";else{var l={};l.type="add"}if(l){l.object=i,l.oldValue=r,s([l]),n.oldVer=[];for(var p=0;p<i.length;p++)n.oldVer.push(i[p])}}e()})}();var lexer=function(){function e(){return{subVars:{},words:[],segments:[],brakLength:0}}function t(e,t,i){if(o.test(e)){var s=r(i,t);return c="var",s}return a.test(e)?(c="str",n(t,RegExp.$1)):(c="",e)}function n(e,t){for(var n=!1,r=t,i=1;i<e.length;i++){var s=e[i];if("\\"!==s){if(!n&&s===t)return r+t;r+=s,n=!1}else n=!0,r+=s}}function r(n,i,s,a){for(var c="",p=[],v=-1,u=-1,f=-1,d=a||e(),_=0;_<i.length;_++){var m=i[_];if(p.length>0)if(l.test(m)){var g=e(),$=r(n,i.substr(_),!0,g);_=_+$.length-1;var y=$;o.test($[0])&&(d.subVars["."+$]=g,h.indexOf(y)<0&&(y=["."+y])),d.words.push(y)}else if("]"===m||")"===m){if(p.pop(),0===p.length){var b=i.substring(v,_+1);c+=b,d.segments.push(b),f=_}d.words.push(m),u=_}else{var w=t(m,i.substr(_),n);_=_+w.length-1,d.words.push(w),u=_}else if(l.test(m)){if(c+=m,"."===m){var y=c.substr(f+1);y=y.replace(/\./,""),y&&(d.segments.push(y),f=_)}}else{if("["!==m&&"("!==m){if("]"!==m&&")"!==m||!s){var y=c.substr(u+1);y&&("."!==y[0]&&h.indexOf(y)<0&&(y=["."+y]),d.words.push(y));var x=c.substr(f+1);return x&&(d.segments.push(x),f=_),!s&&h.indexOf(y)<0&&(n["."+c]=d),c}var y=c;if(y[y.length-1]!==m){/[a-zA-Z0-9$_]+\[.+\]/.test(c)?(y=y.replace(/[a-zA-Z0-9$_]+\[.+\]/,""),d.words.push(y)):h.indexOf(y)<0&&d.words.push(["."+y]);var O=y.lastIndexOf(".");O>0&&(y=y.substr(O)),d.segments.push(y),f=_}return u=_,c}p.push(m),v=_,d.brakLength++;var E=c.substr(u+1);if(E){var y=E;h.indexOf(E)<0&&0>u&&(y=["."+E]),d.words.push(y)}d.words.push(m);var C="["===m?"]":")";if(c[_-1]!==C){var T=E.lastIndexOf(".");T>-1?(E=E.substr(T),d.segments.push(E)):d.segments.push(E),f=_}u=_}}var P=c.substr(c.lastIndexOf("]")+1),F=c.substr(c.lastIndexOf(")")+1);if(P&&F){var R=P.length<F.length?P:F,x=c.substr(f+1);d.segments.push(x);var y="["===R[0]||"("===R[0]?R:"."===R[0]?R:"."+R;d.words.length<1&&h.indexOf(y)<0&&(y=[y]),d.words.push(y)}return s||(n["."+c]=d),c}function i(e){for(var t in e){var n=e[t],r=null,a=null,o=t.lastIndexOf(".");if("]"===t[t.length-1]||")"===t[t.length-1]){o=s(t,n.brakLength);var l="]"===t[t.length-1]?"[":"(",h=n.brakLength;n.watchPathWords=[];for(var c=0;c<n.words.length;c++){var p=n.words[c];if(p===l&&--h<1)break;n.watchPathWords.push(p)}}else n.watchPathWords=n.words.concat(),n.watchPathWords.splice(-1,1);r=t.substr(o),n.lastVar="("===r[0]?t:r,Object.keys(n.subVars).length<1&&(a=t.substring(0,o).replace(/\.$/,""),n.watchPath=a);for(var c=n.segments.length;c--;)n.segments[c]=n.segments[c].replace(/^\.|\.$/g,"");i(n.subVars)}}function s(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(("["===r||"("===r)&&--t<1)return n}}var a=/(['"])/,o=/[a-zA-Z$_]/,l=/[a-zA-Z$_0-9.]/,h=["as","instanceof","typeof","in","true","false"],c="",p={};return function(e){if(p[e])return p[e];for(var n=[],r={},s=0;s<e.length;s++){var a=e[s];c="";var o=t(a,e.substr(s),r);switch(s=s+o.length-1,c){case"var":n.push(h.indexOf(o)<0?["."+o]:o);break;case"str":case"":n.push(o)}}return i(r),p[e]={words:n,varTree:r},p[e]}}(),Scanner=new function(){function e(e){var n=[],r=[];t(e,n);for(var i=n.length;i--;){var e=n[i],s=e.nodeValue,a=[],o=0;s.replace(REG_EXP,function(e,t,n){a.push(s.substring(o,n)),a.push(e),o=n+e.length}),a.push(s.substring(o,s.length));for(var l=document.createDocumentFragment(),h=0;h<a.length;h++){var c=document.createTextNode(a[h]);l.appendChild(c)}r.unshift(l)}for(var h=n.length;h--;){var p=n[h];r[h].childNodes.length>1&&p.parentNode&&p.parentNode.replaceChild(r[h],p)}}function t(e,n){if("SCRIPT"!==e.tagName)if(e.attributes||11===e.nodeType){if(e.childNodes.length>0)for(var r=0,i=e.childNodes.length;i>r;r++)t(e.childNodes[r],n)}else if(3===e.nodeType){if(e.nodeValue.replace(/\t|\r|\s/gim,"").length<1)return;n.push(e)}}function n(e){if(e.$restrict)return e;for(var t=e.$parent;t;){if(t.$name&&t.$restrict)return t;t=t.$parent}return null}function r(e,t){if("SCRIPT"!==e.tagName)if(e.attributes||11===e.nodeType){if(e.tagName){var s=e.tagName.toLowerCase();if(ComponentFactory.hasTypeOf(s)){var a=n(t);if(a&&a.$restrict.children){var o=a.$restrict.children.split(",");if(o.indexOf(s)<0)return}var l=ComponentFactory.getRestrictOf(s);if(l&&l.parents){var h=l.parents.split(",");if(h.indexOf(a.$name)<0)return}return void t.createSubComponentOf(s,e)}for(var c=e.attributes,p=c.length;p--;){var v=c[p].name.replace(CMD_PREFIX,""),u=v.indexOf(CMD_PARAM_DELIMITER);if(u>-1&&(v=v.substring(0,u)),DirectiveFactory.hasTypeOf(v)){if(DirectiveFactory.isFinal(v)){var f=DirectiveFactory.newInstanceOf(v,[e],t,c[p].name,c[p].value);return void t.$__directives.push(f)}if(DirectiveFactory.hasEndTag(v))return[v,c[p].value]}}for(var p=c.length;p--;){var d=c[p],_=d.name,m=d.value;if(REG_CMD.test(_)){var v=_.replace(CMD_PREFIX,""),u=v.indexOf(CMD_PARAM_DELIMITER);if(u>-1&&(v=v.substring(0,u)),DirectiveFactory.hasTypeOf(v)){var f=DirectiveFactory.newInstanceOf(v,[e],t,c[p].name,m);t.$__directives.push(f)}}else REG_EXP.test(m)&&i(m,e,t,_)}}if(e.childNodes.length>0){for(var g=null,$=[],p=0,y=e.childNodes.length;y>p;p++)if(g){$.push(e.childNodes[p]);var b=DirectiveFactory.hasEndTag(g[0]),w=e.childNodes[p].getAttribute&&e.childNodes[p].getAttribute(CMD_PREFIX+b);if(Util.isString(w)){var f=DirectiveFactory.newInstanceOf(g[0],$,t,CMD_PREFIX+g[0],g[1]);t.$__directives.push(f),g=null,$=[]}}else g=r(e.childNodes[p],t),g&&$.push(e.childNodes[p]);g&&LOGGER.error("can not find endTag of directive["+CMD_PREFIX+g[0]+"]")}}else if(3===e.nodeType){if(e.nodeValue.replace(/\t|\r|\s/gim,"").length<1)return;i(e.nodeValue,e,t)}}function i(e,t,n,r){var i={},a=!r&&0===e.replace(/\s*/gm,"").indexOf(EXP_START_TAG+EXP2HTML_EXP_TAG);if(a&&(e=e.replace(EXP2HTML_EXP_TAG,"")),e.replace(REG_EXP,function(e,t){var r={},a=1;FILTER_EXP.test(t)&&(s(RegExp.$1,r,n),a=t.indexOf(FILTER_EXP_START_TAG));var o=t;a>1&&(o=t.substring(0,a));var l=lexer(o);i[t]={words:l.words,varTree:l.varTree,filters:r}}),!(Object.keys(i).length<1)){var o=new ExpNode(t,r,e,i,n,a);n.$__expNodes.push(o)}}function s(e,t,n){for(var r,i,s=!0,a="",o="",l=[],h=0;h<e.length;h++){var c=e[h];switch(c){case" ":case"	":i=!0;continue;case":":r=!0,s=!1,i=!1,o&&(l.push(o),o="");continue;case".":r=!1,s=!0,i=!1,a&&FilterFactory.hasTypeOf(a)&&(t[a]=[FilterFactory.newInstanceOf(a,n),l]),o&&l.push(o),a="",o="",l=[];continue;default:if(i)return a&&(t[a]=[FilterFactory.newInstanceOf(a,n),l]),o&&l.push(o),h}s?a+=c:r&&(o+=c)}a&&FilterFactory.hasTypeOf(a)&&(t[a]=[FilterFactory.newInstanceOf(a,n),l]),o&&l.push(o)}this.scan=function(t,n){for(var i=t.elements?t.elements:[t.element],s=null,a=[],o=0,l=i.length;l>o;o++)if(e(i[o]),s){a.push(i[o]);var h=DirectiveFactory.hasEndTag(s[0]),c=i[o].getAttribute&&i[o].getAttribute(CMD_PREFIX+h);if(Util.isString(c)){var p=DirectiveFactory.newInstanceOf(s[0],a,n,CMD_PREFIX+s[0],s[1]);n.$__directives.push(p),s=null,a=[]}}else s=r(i[o],n),s&&a.push(i[o]);s&&LOGGER.error("can not find endTag of directive["+CMD_PREFIX+s[0]+"]")}},Builder=new function(){function e(e){for(var n=e.$__expNodes.length;n--;){var r=e.$__expNodes[n];for(var i in r.expMap){var s=r.expMap[i],a=s.varTree;for(var o in a){var l=a[o];t(e,l,r)}}}for(var n=e.$__components.length;n--;){var h=e.$__components[n];e.$__directives.indexOf(h)>-1||(h.init(),h.display())}for(var n=e.$__directives.length;n--;){var c=e.$__directives[n];c.init()}}function t(e,r,i){for(var s in r.subVars){var a=r.subVars[s];t(e,a,i)}for(var o=n(e.$__expPropRoot.subProps,r.segments[0],i),l=1;l<r.segments.length;l++)o=n(o.subProps,r.segments[l],i)}function n(e,t,n){var r=e[t];return r||(r=e[t]=new ExpProp(t)),n instanceof ExpNode?r.expNodes.indexOf(n)<0&&r.expNodes.push(n):n instanceof AttrObserveNode?r.attrObserveNodes.indexOf(n)<0&&r.attrObserveNodes.push(n):n instanceof Watch&&r.watchs.indexOf(n)<0&&r.watchs.push(n),e[t]}function r(e,t,n){function s(e){n.$__state!==Component.state.suspend&&n.$__state!==Component.state.destroyed&&i(e)}var a=Util.isArray(e),o=Util.isObject(e);if(e&&(a||o)){if(e.$__impex__observer){var l=t.join(".");if(e.$__impex__propChains[l]){for(var h=e.$__impex__propChains[l],c=h.length;c--;)if(h[c][1]===n)return;return void h.push([t,n])}return void(e.$__impex__propChains[t.join(".")]=[[t,n]])}if(e.$__impex__observer=s,e.$__impex__propChains={},e.$__impex__propChains[t.join(".")]=[[t,n]],a)e.$__impex__oldVal=e.concat(),Array_observe(e,s);else if(o){if(Util.isDOM(e))return;Object_observe(e,s)}for(var p=Object.keys(e),c=p.length;c--;){var l=p[c];if(0!==l.indexOf("$")){var v=t.concat();v.push(l),r(e[l],v,n)}}}}function i(e){if(!Util.isString(e))for(var t=e.length;t--;){var n=e[t],i=n.name;if(!i||0!==i.indexOf("$")){var s=n.object[i],a=n.oldValue;Util.isArray(n.object)&&(s=n.object,a=n.object.$__impex__oldVal);for(var l=n.object.$__impex__propChains,h=Object.keys(l),c=h.length;c--;)for(var p=h[c],v=l[p],u=v.length;u--;){var f=v[u][0],d=v[u][1],_=f.concat();i&&!Util.isArray(n.object)&&_.push(i),o(d,_,n.type,s,a),r(s,_,d)}if(!Util.isArray(n.object)&&Util.isArray(n.oldValue))Array_unobserve(n.oldValue,n.oldValue.$__impex__observer);else{if(Util.isArray(n.object))return void(n.object.$__impex__oldVal=n.object.concat());if(Util.isObject(n.oldValue)){var m=n.oldValue.$__impex__observer;m&&(Object_unobserve(n.oldValue,m),n.oldValue.$__impex__observer=null,n.oldValue.$__impex__propChains=null)}}}}}function s(e,t,n,r,i){for(var s,o=e.$__expPropRoot.subProps,l=0;l<t.length;l++){var h=t[l];{if(!o[h])break;s=o[h],o=o[h].subProps}}if(s){var c=t.length-l,p=[];c>0?a(s,c,p):p.push(s);for(var v=[],l=p.length;l--;){Renderer.renderExpNode(p[l].expNodes);for(var u=p[l].attrObserveNodes.length;u--;){var f=p[l].attrObserveNodes[u],d=Renderer.evalExp(f.directive,f.expObj);f.directive.observe(d)}for(var u=p[l].watchs.length;u--;){var _=p[l].watchs[u];if(!(_.segments.length<t.length||v.indexOf(_)>-1)){for(var m=!0,g=0;g<_.segments.length&&t[g];g++)if("["!==_.segments[g][0]&&"["!==t[g][0]&&_.segments[g]!==t[g]){m=!1;break}if(m){var $=r,y=i;if(_.segments.length>t.length){for(var b=_.segments.slice(g),w="$var",g=0;g<b.length;g++){var x=b[g];w+="["===x[0]?x:"."+x}try{$=new Function("$var","return "+w)(r),y=new Function("$var","return "+w)(i)}catch(O){LOGGER.debug("error on parse watch params"),$=null}}_.cbk&&_.cbk.call(_.ctrlScope,n,$,y),v.push(_)}}}}}}function a(e,t,n){if(1>t)return void n.push(e);for(var r in e.subProps)a(e.subProps[r],t-1,n)}function o(e,t,n,r,i){s(e,t,n,r,i);for(var a=e.$__components.length;a--;){var l=e.$__components[a];o(l,t,n,r,i)}}this.buildExpModel=t,this.build=function(t){e(t),r(t,[],t)}},Renderer=new function(){function renderExpNode(e){for(var t={},n=e.length;n--;){var r=e[n];if(body.contains(r.node)||r.toHTML){var i=null;if(t[r.origin]&&t[r.origin].comp===r.component?i=t[r.origin].val:(i=calcExp(r.component,r.origin,r.expMap),t[r.origin]={comp:r.component,val:i}),r.toHTML){var s=renderHTML(r,i,r.node,r.component);if(s)continue}null!==i&&updateDOM(r.node,r.attrName,i)}}}function updateDOM(e,t,n){if(e.setAttribute){e.setAttribute(t,n);var r=propMap[t];r&&r.indexOf(e.tagName)>-1&&(e[t]=n)}else try{e.nodeValue=n}catch(i){}}function calcExp(e,t,n){var r={};for(var i in n){var s=n[i],a=evalExp(e,s),o=s.filters;if(Object.keys(o).length>0)for(var l in o){var h=o[l][0],c=o[l][1];h.$value=a,a=h.to.apply(h,c)}r[i]=void 0===a?"":a}for(var l in r)t=t.replace(EXP_START_TAG+l+EXP_END_TAG,r[l]);return t}function evalExp(e,t){var n=getExpEvalStr(e,t),r="";try{r=new Function("return "+n)()}catch(i){LOGGER.debug(i.message+' when eval "'+n+'"')}return r}function getExpEvalStr(e,t){var n=t.varTree,r={};for(var i in n){var s=n[i],a=buildVarPath(e,s,i);r[i]=a}var o=joinExpStr(t.words,r);return o}function joinExpStr(e,t){for(var n="",r=0;r<e.length;r++){var i=e[r];n+=i instanceof Array?t[i[0]]:i}return n}function keyWordsMapping(e,t){return"this"===e?t.__getPath():void 0}function buildVarPath(e,t,n){var r={};for(var i in t.subVars){var s=t.subVars[i],a=buildVarPath(e,s,i);r[i]=a}for(var o=!1,l="",h=0;h<t.words.length;h++){var c=t.words[h];if(c instanceof Array){var p=keyWordsMapping(t.segments[0],e);if(p){o=!0;var v=new RegExp("^\\."+t.segments[0]);l+=c[0].replace(v,p)}else l+=r[c[0]]||c[0]}else l+=c}var u="";if(t.watchPath)u=t.watchPath;else for(var h=0;h<t.watchPathWords.length;h++){var c=t.watchPathWords[h];u+=c instanceof Array?r[c[0]]||c[0]:c}return e=u?varInCtrlScope(e,u):varInCtrlScope(e,l),o?l:(e?e.__getPath():"self")+l}function varInCtrlScope(e,t){for(var n=e;n;){if(void 0!==getVarByPath(t,n.__getPath()))return n;n=n.$parent}}function getVarByPath(path,mPath){var varExp=mPath+path,rs=void 0;try{rs=eval(varExp.replace(/^\./,""))}catch(e){}return rs}function renderHTML(e,t,n,r){if(e.__lastVal!==t&&3==n.nodeType){var i=new View([n]);if(Util.isUndefined(e.__lastVal)){var s=ViewManager.createPlaceholder("-- [html] placeholder --");ViewManager.insertBefore(s,i),e.__lastVal=t,e.__placeholder=s}e.__lastComp&&(e.__lastComp.destroy(),i=ViewManager.createPlaceholder(""),ViewManager.insertAfter(i,e.__placeholder)),Util.isDOMStr(t)||(t=t.replace(/</gm,"&lt;").replace(/>/gm,"&gt;"));var a=r.createSubComponent(t,i);return a.init(),a.display(),e.__lastComp=a,e.__lastVal=t,!0}}this.render=function(e){renderExpNode(e.$__expNodes);for(var t=e.$__components.length;t--;)Renderer.render(e.$__components[t])};var body=document.body;this.renderExpNode=renderExpNode;var propMap={value:["INPUT"]};this.evalExp=evalExp,this.getExpEvalStr=getExpEvalStr};ViewModel.prototype={data:function(path,val){var expObj=lexer(path),evalStr=Renderer.getExpEvalStr(this,expObj);if(arguments.length>1){Util.isObject(val)||Util.isArray(val)?val=JSON.stringify(val):Util.isString(val)&&(val='"'+val.replace(/\r\n|\n/gm,"\\n").replace(/"/gm,'\\"')+'"');try{eval(evalStr+"= "+val)}catch(e){LOGGER.debug(e.message+"eval error on data("+evalStr+"= "+val+")")}return this}try{return eval(evalStr)}catch(e){LOGGER.debug(e.message+"eval error on data("+evalStr+")")}},closest:function(e){var t=lexer(e),n=Renderer.getExpEvalStr(this,t);return n.replace(/^impex\.__components\["(C_[0-9]+)"\]/,""),impex.__components[RegExp.$1]}},Component.state={created:"created",inited:"inited",displayed:"displayed",destroyed:"destroyed",suspend:"suspend"},Util.inherits(Component,ViewModel),Util.ext(Component.prototype,{on:function(e,t,n){this.$view.__on(this,e,t,n)},off:function(e,t){this.$view.__off(this,e,t)},find:function(e,t,n){e=e.toLowerCase();for(var r=this.$__components.length;r--;){var i=this.$__components[r];if("*"===e||i.$name===e){var s=!0;if(t)for(var a in t)if(i[a]!==t[a]){s=!1;break}if(s)return i}if(n&&i.$__components.length>0){var o=i.find(e,t,!0);if(o)return o}}return null},findD:function(e,t){e=e.toLowerCase();for(var n=this.$__directives.length;n--;){var r=this.$__directives[n];if("*"===e||r.$name===e){var i=!0;if(t)for(var s in t)if(r[s]!==t[s]){i=!1;break}if(i)return r}}return null},watch:function(e,t){var n=lexer(e),r=Object.keys(n.varTree);if(!(r.length<1)){if(r.length>1)return void LOGGER.warn("error on parsing watch expression["+e+"], only one property can be watched at the same time");var i=n.varTree[r[0]],s=new Watch(t,this,i.segments);return Builder.buildExpModel(this,i,s),this}},add:function(e){this.$__components.push(e),e.$parent=this},createSubComponentOf:function(e,t){var n=ComponentFactory.newInstanceOf(e,t.elements?t.elements[0]:t);return this.$__components.push(n),n.$parent=this,n},createSubComponent:function(e,t){var n=ComponentFactory.newInstance(e,t&&t.elements[0]);return this.$__components.push(n),n.$parent=this,n},init:function(){if(this.$__state===Component.state.created){if(this.$templateURL){var e=this;Util.loadTemplate(this.$templateURL,function(t){var n=e.$view.__init(t,e);n!==!1&&(e.__init(t),e.display())})}else{if(this.$template){var t=this.$view.__init(this.$template,this);if(t===!1)return}this.__init(this.$template)}return this}},__init:function(e){Scanner.scan(this.$view,this),LOGGER.log(this,"inited");var t=null;return this.onInit&&(t=this.onInit(e)),t===!1?void this.destroy():void(this.$__state=Component.state.inited)},display:function(){(this.$__state===Component.state.inited||this.$__state===Component.state.suspend)&&(this.$view.__display(),this.$__suspendParent&&(this.$__suspendParent.add(this),this.$__suspendParent=null),Renderer.render(this),this.$__state=Component.state.displayed,Builder.build(this),LOGGER.log(this,"displayed"),this.onDisplay&&this.onDisplay())},destroy:function(){if(this.$__state!==Component.state.destroyed){if(LOGGER.log(this,"destroy"),this.$parent){var e=this.$parent.$__components.indexOf(this);e>-1&&this.$parent.$__components.splice(e,1),this.$parent=null}for(this.$view.__destroy(this);this.$__components.length>0;)this.$__components[0].destroy();this.$view=this.$__components=this.$__directives=this.$__expNodes=this.$__expPropRoot=null,this.onDestroy&&this.onDestroy(),this.$__state=Component.state.destroyed}},suspend:function(e){if(this instanceof Directive||this.$__state===Component.state.displayed){if(LOGGER.log(this,"suspend"),this.$parent){var t=this.$parent.$__components.indexOf(this);t>-1&&this.$parent.$__components.splice(t,1),this.$__suspendParent=this.$parent,this.$parent=null}this.$view.__suspend(this,e===!1?!1:!0),this.onSuspend&&this.onSuspend(),this.$__state=Component.state.suspend}},__getPath:function(){return'impex.__components["'+this.$__id+'"]'}}),View.prototype={__init:function(e,t){var n=this.__target.attributes,r=this.__target.innerHTML,i=tmplExpFilter(e,r,n),s=DOMViewProvider.compile(i);if(!s||s.length<1)return LOGGER.warn('invalid template "'+e+'" of component['+t.$name+"]"),!1;if(this.elements=s,n)for(var a=n.length;a--;){var o=n[a].name,l=n[a].value;t[o]=l}},__display:function(){if(this.__target&&this.__target.parentNode&&(!this.elements[0].parentNode||1!==this.elements[0].parentNode.nodeType)){var e=null;if(this.elements.length>1){e=document.createDocumentFragment();for(var t=0;t<this.elements.length;t++)e.appendChild(this.elements[t])}else e=this.elements[0];this.__target.parentNode.replaceChild(e,this.__target),e=null,this.__target=null}},__destroy:function(e){for(var t in this.__evMap)for(var n=this.__evMap[t],r=n.length;r--;)for(var i=n[r],s=i[1],a=this.elements.length;a--;)1===this.elements[a].nodeType&&Util.off(t,this.elements[a],s);var o=this.elements[0].parentNode;if(o){this.elements[0].__impex__view&&(this.elements[0].__impex__view=null);for(var r=this.elements.length;r--;)o.removeChild(this.elements[r])}this.__target&&(this.__target.parentNode.removeChild(this.__target),this.__target=null)},__suspend:function(e,t){if(this.elements[0].parentNode){t&&(this.__target=document.createComment("-- view suspended of ["+(e.$name||"anonymous")+"] --"),this.elements[0].parentNode.insertBefore(this.__target,this.element));for(var n=null,r=this.elements.length;r--;)if(this.elements[r].parentNode){n=this.elements[r].parentNode;break}if(n)for(var r=this.elements.length;r--;)this.elements[r].parentNode&&n.removeChild(this.elements[r])}},__on:function(e,t,n,r){for(var i=n,s=e,a="",o=null,l=function(e){var n=i;if(r instanceof Function&&(n=r.call(s,e,i)),n){if(a!=n){var l=lexer(n),h=Renderer.getExpEvalStr(s,l),c=h.replace("self.$event","$event");o=new Function("$event",c),a=n}try{o(e)}catch(p){LOGGER.debug(p.message+"eval error on event "+t+"("+c+")")}}},h=this.elements.length;h--;){var c=this.elements[h];1===c.nodeType&&Util.on(t,c,l)}this.__evMap[t]||(this.__evMap[t]=[]),this.__evMap[t].push([n,l])},__off:function(e,t,n){for(var r=this.__evMap[t],i=r.length;i--;){var s=r[i],a=s[0],o=s[1];if(a==n)for(var l=this.elements.length;l--;)1===this.elements[l].nodeType&&Util.off(t,this.elements[l],o)}},clone:function(){for(var e=[],t=this.elements.length;t--;){var n=this.elements[t].cloneNode(!0);e.unshift(n)}var r=new View(e);return r},show:function(){for(var e=this.elements.length;e--;)1===this.elements[e].nodeType&&(this.elements[e].style.display="");return this},hide:function(){for(var e=this.elements.length;e--;)1===this.elements[e].nodeType&&(this.elements[e].style.display="none");return this},style:function(e,t){if(arguments.length>1){for(var n=this.elements.length;n--;)1===this.elements[n].nodeType&&(this.elements[n].style[e]=t);return this}for(var n=0;n<this.elements.length&&1!==this.elements[n].nodeType;n++);return this.elements[n].style[e]},attr:function(e,t){if(arguments.length>1){for(var n=this.elements.length;n--;)1===this.elements[n].nodeType&&this.elements[n].setAttribute(e,t);return this}for(var n=0;n<this.elements.length&&1!==this.elements[n].nodeType;n++);return this.elements[n].getAttribute(e)},removeAttr:function(e){for(var t=this.elements.length;t--;)1===this.elements[t].nodeType&&this.elements[t].removeAttribute(e);return this},hasClass:function(e){for(var t=0;t<this.elements.length&&1!==this.elements[t].nodeType;t++);return this.elements[t].className.indexOf(e)>-1},addClass:function(e){e=e.replace(/\s+/gm," ").replace(/^\s*|\s*$/gm,"");for(var t=0;t<this.elements.length;t++)1===this.elements[t].nodeType&&(this.elements[t].className+=" "+e)},removeClass:function(e){e=e.replace(/\s+/gm," ").replace(/^\s*|\s*$/gm,"");for(var t=e.split(" "),n=t.length;n--;)for(var r=t[n],i=new RegExp("^"+r+"s+|s+"+r+"$|s+"+r+"s+","img"),s=0;s<this.elements.length;s++)1===this.elements[s].nodeType&&this.elements[s].className.replace(i,"")},toggleClass:function(e){e=e.replace(/\s+/gm," ").replace(/^\s*|\s*$/gm,"");for(var t=e.split(" "),n=0;n<this.elements.length&&1!==this.elements[n].nodeType;n++);for(var r=!1,i=t.length;i--;){var s=t[i];if(this.elements[n].className.indexOf(s)<0){r=!0;break}}for(var n=0;n<this.elements.length;n++)if(1===this.elements[n].nodeType)if(r)this.elements[n].className+=" "+e;else for(var i=t.length;i--;){var s=t[i],a=new RegExp("^"+s+"s+|s+"+s+"$|s+"+s+"s+","img");this.elements[n].className.replace(a,"")}}};var DOMViewProvider=new function(){var e=document.createElement("div");this.newInstance=function(t,n){if(""===t)return new View([document.createTextNode("")],n);if(e.innerHTML=t,!e.childNodes[0])return null;for(var r=[];e.childNodes.length>0;){var i=e.removeChild(e.childNodes[0]);r.push(i)}var s=new View(r,n);return s};var t=["meta","title","base"];this.compile=function(n){if(e.innerHTML=n,!e.children[0])return null;for(var r=[];e.children.length>0;){var i=e.removeChild(e.children[0]),s=i.nodeName.toLowerCase();t.indexOf(s)>-1||r.push(i)}return r}},ViewManager=new function(){this.$singleton=!0,this.replace=function(e,t){var n=t.elements[0],r=e.elements[0],i=t.elements[0].parentNode,s=r;if(e.elements.length>1){s=document.createDocumentFragment();for(var a=0;a<e.elements.length;a++)s.appendChild(e.elements[a])}if(t.elements.length>1){i.insertBefore(s,n);for(var a=t.elements.length;a--;)i.removeChild(t.elements[a])}else i.replaceChild(s,n)},this.insertBefore=function(e,t){var n=t.elements[0],r=e.elements[0],i=t.elements[0].parentNode,s=r;if(e.elements.length>1){s=document.createDocumentFragment();for(var a=0;a<e.elements.length;a++)s.appendChild(e.elements[a])}i&&i.insertBefore(s,n)},this.insertAfter=function(e,t){var n=t.elements[0],r=e.elements[0],i=t.elements[0].parentNode,s=i.lastChild,a=r;if(e.elements.length>1){a=document.createDocumentFragment();for(var o=0;o<e.elements.length;o++)a.appendChild(e.elements[o])}if(s==n)i.appendChild(a);else{var l=t.elements[t.elements.length-1].nextSibling;i.insertBefore(a,l)}},this.createPlaceholder=function(e){return new View([document.createComment(e)])}};Util.inherits(Directive,Component),Util.ext(Directive.prototype,{init:function(){var e={},t=this;this.$value.replace(REG_EXP,function(n,r){var i=lexer(r),s=Renderer.evalExp(t.$parent,i);e[r]={val:s}});var n=this.$value;for(var r in e)n=n.replace(EXP_START_TAG+r+EXP_END_TAG,e[r].val);if(this.$view&&this.$view.elements[0].setAttribute(this.$name,n),this.$value=n,LOGGER.log(this,"inited"),this.onInit&&this.onInit(),this.$__state=Component.state.inited,this.observe){var i=lexer(n);for(var s in i.varTree){var a=i.varTree[s],o=new AttrObserveNode(this,i);this.$parent&&Builder.buildExpModel(this.$parent,a,o)}var l=Renderer.evalExp(this.$parent,i);this.observe(l)}}}),Filter.prototype={to:function(){return null}},Factory.prototype={register:function(e,t,n){if(e=e.toLowerCase(),this.baseClass===Component||this.baseClass===Directive)for(var r=Object.keys(t),i=BUILD_IN_PROPS.length;i--;)if(r.indexOf(BUILD_IN_PROPS[i])>-1)return void LOGGER.error("attempt to overwrite build-in property["+BUILD_IN_PROPS[i]+"] of Component["+e+"]");var s=new Function("clazz","var args=[];for(var i=1;i<arguments.length;i++)args.push(arguments[i]);clazz.apply(this,args)"),a={};Util.extProp(a,t),Util.inherits(s,this.baseClass),Util.extMethod(s.prototype,t),this.types[e]={clazz:s,props:a,services:n}},hasTypeOf:function(e){return e in this.types}},Util.inherits(_ComponentFactory,Factory),Util.ext(_ComponentFactory.prototype,{getRestrictOf:function(e){return this.types[e].props.$restrict},newInstance:function(e){var t=null;if(2===arguments.length){var n=arguments[0],r=arguments[1];t=n,Util.isString(n)?t=this.viewProvider.newInstance(n,r):t.__target=r}else t=e,Util.isDOM(e)&&(t=new View([e]));var i=new this.baseClass(t);this.instances.push(i);var s=arguments[2],a=arguments[3];if(s){for(var o=Object.keys(s),l=BUILD_IN_PROPS.length;l--;)if(o.indexOf(BUILD_IN_PROPS[l])>-1)return void LOGGER.error("attempt to overwrite build-in property["+BUILD_IN_PROPS[l]+"] of Component");Util.ext(i,s)}if(Util.isArray(a)){for(var h=[],l=0;l<a.length;l++){var c=ServiceFactory.newInstanceOf(a[l],i);h.push(c)}i.onCreate&&i.onCreate.apply(i,h)}else i.onCreate&&i.onCreate();return i},newInstanceOf:function(e,t){if(!this.types[e])return null;var n=new this.types[e].clazz(this.baseClass);Util.extProp(n,this.types[e].props),n.$view=new View(null,t),n.$name=e,this.instances.push(n);var r=null;if(this.types[e].services){r=[];for(var i=0;i<this.types[e].services.length;i++){var s=ServiceFactory.newInstanceOf(this.types[e].services[i],n);r.push(s)}}return n.onCreate&&n.onCreate.apply(n,r),n}});var ComponentFactory=new _ComponentFactory(DOMViewProvider);Util.inherits(_DirectiveFactory,Factory),Util.ext(_DirectiveFactory.prototype,{isFinal:function(e){return!!this.types[e].props.$final},hasEndTag:function(e){return this.types[e].props.$endTag},newInstanceOf:function(e,t,n,r,i){if(!this.types[e])return null;var s=null,a=null,o=r.indexOf(CMD_PARAM_DELIMITER);if(o>-1){s=r.substr(o+1);var l=s.indexOf(CMD_FILTER_DELIMITER);l>-1&&(a=s.substr(l+1),s=s.substring(0,l)),s=s.split(CMD_PARAM_DELIMITER)}var h=new this.types[e].clazz(this.baseClass,r,i,n);Util.extProp(h,this.types[e].props),t[0].__impex__view?h.$view=t[0].__impex__view:(h.$view=new View(t),
t[0].__impex__view=h.$view),s&&(h.$params=s),a&&(h.$filter=a);var c=null;if(this.types[e].services){c=[];for(var o=0;o<this.types[e].services.length;o++){var p=ServiceFactory.newInstanceOf(this.types[e].services[o],h);c.push(p)}}return n.add(h),h.onCreate&&(c?h.onCreate.apply(h,c):h.onCreate()),this.instances.push(h),h}});var DirectiveFactory=new _DirectiveFactory;Util.inherits(_FilterFactory,Factory),Util.ext(_FilterFactory.prototype,{newInstanceOf:function(e,t){if(!this.types[e])return null;var n=new this.types[e].clazz(this.baseClass,t);Util.extProp(n,this.types[e].props),this.instances.push(n);var r=null;if(this.types[e].services){r=[];for(var i=0;i<this.types[e].services.length;i++){var s=ServiceFactory.newInstanceOf(this.types[e].services[i],n);r.push(s)}}return n.onCreate&&n.onCreate.apply(n,r),n}});var FilterFactory=new _FilterFactory;Util.inherits(_ServiceFactory,Factory),Util.ext(_ServiceFactory.prototype,{newInstanceOf:function(e,t){if(e=e.toLowerCase(),!this.types[e])return null;var n=null;this.types[e].props.$singleton?(this.types[e].singleton||(this.types[e].singleton=new this.types[e].clazz(this.baseClass)),n=this.types[e].singleton):(n=new this.types[e].clazz(this.baseClass),this.instances.push(n),Util.extProp(n,this.types[e].props));var r=null;if(this.types[e].services){r=[];for(var i=0;i<this.types[e].services.length;i++){var s=ServiceFactory.newInstanceOf(this.types[e].services[i],n);r.push(s)}}return n.$host=t,n.onCreate&&n.onCreate.apply(n,r),n}});var ServiceFactory=new _ServiceFactory,CMD_PREFIX="x-",CMD_PARAM_DELIMITER=":",CMD_FILTER_DELIMITER=".",EXP_START_TAG="{{",EXP_END_TAG="}}",REG_EXP=/\{\{(.*?)\}\}/gim,REG_TMPL_EXP=/\{\{=(.*?)\}\}/gim,REG_CMD=/x-.*/,EXP2HTML_EXP_TAG="#",EXP2HTML_START_EXP=/^\s*#/,FILTER_EXP=/=>\s*(.+?)$/,FILTER_EXP_START_TAG="=>",LOGGER=new function(){this.log=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}},BUILD_IN_PROPS=["data","closest","add","on","off","find","watch","init","display","destroy","suspend"],impex=new function(){function e(e){var n=e;do{if(t.indexOf(n)>-1)return!0;n=n.parentNode}while(n);return!1}this.version={v:[0,7,0],state:"beta",toString:function(){return impex.version.v.join(".")+" "+impex.version.state}},this.website="http://mrsoya.github.io/impex",this.config=function(e){var t=e.delimiters||[];EXP_START_TAG=t[0]||"{{",EXP_END_TAG=t[1]||"}}",REG_EXP=new RegExp(EXP_START_TAG+"(.*?)"+EXP_END_TAG,"img"),REG_TMPL_EXP=new RegExp(EXP_START_TAG+"=(.*?)"+EXP_END_TAG,"img"),LOGGER=e.logger||new function(){this.log=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}}},this.component=function(e,t,n){return ComponentFactory.register(e,t,n),this},this.directive=function(e,t,n){return DirectiveFactory.register(e,t,n),this},this.service=function(e,t,n){return ServiceFactory.register(e,t,n),this},this.filter=function(e,t,n){return FilterFactory.register(e,t,n),this},this.render=function(n,r,i){var s=n.tagName.toLowerCase();if(e(n))return void LOGGER.warn("element ["+s+"] has been rendered");var a=ComponentFactory.newInstanceOf(s,n);return a||(t.push(n),a=ComponentFactory.newInstance(n,null,r,i)),a.init(),a.display(),a};var t=[];this.__components={},this.findAll=function(e,t){e=e.toLowerCase();for(var n=[],r=Object.keys(this.__components),i=r.length;i--;){var s=this.__components[r[i]];if("*"===e||s.$name===e){var a=!0;if(t)for(var o in t)if(s[o]!==t[o]){a=!1;break}a&&n.push(s)}}return n}};impex.service("ViewManager",ViewManager),impex.service("ComponentManager",new function(){this.hasTypeOf=function(e){return ComponentFactory.hasTypeOf(e)},this.findAll=function(e){for(var t=ComponentFactory.instances,n=[],r=t.length;r--;){var i=!0;for(var s in e)if(comp[s]!=e[s]){i=!1;break}i&&n.push(comp)}return n}}),!function(e){function t(e,n,r){for(var i=e.$__expNodes.length;i--;){var s=e.$__expNodes[i];s.node==n&&"class"===s.attrName&&(s.origin=r)}for(var a=e.$__components.length;a--;)t(e.$__components[a],n,r)}function n(){this.onCreate=function(e){this.$eachExp=/(.+?)\s+as\s+((?:[a-zA-Z0-9_$]+?\s*=>\s*[a-zA-Z0-9_$]+?)|(?:[a-zA-Z0-9_$]+?))$/,this.$viewManager=e,this.$expInfo=this.parseExp(this.$value),this.$parentComp=this.$parent,this.$__view=this.$view,this.$cache=[],this.$subComponents=[],this.$cacheSize=20},this.onInit=function(){if(this.$__state!==Component.state.inited){this.$ds=this.$parent.data(this.$expInfo.ds),this.$placeholder=this.$viewManager.createPlaceholder("-- directive [each] placeholder --"),this.$viewManager.insertBefore(this.$placeholder,this.$view),this.build(this.$ds,this.$expInfo.k,this.$expInfo.v),this.destroy();var e=this;this.$parentComp.watch(this.$expInfo.ds,function(t,n,r){var i=0,s=0;for(var a in n)n.hasOwnProperty(a)&&0!==a.indexOf("$")&&i++;if(0===i)s=e.$subComponents.length;else for(var a in r)r.hasOwnProperty(a)&&0!==a.indexOf("$")&&s++;e.rebuild(n,i-s,e.$expInfo.k,e.$expInfo.v)})}},this.rebuild=function(e,t,n,r){if(0>t){var i=this.$subComponents.splice(0,-1*t);if(this.$cache.length<this.$cacheSize){for(var s=i.length;s--;)this.$cache.push(i[s]);for(var s=this.$cache.length;s--;)this.$cache[s].suspend(!1)}else for(var s=i.length;s--;)i[s].destroy()}else if(t>0){for(var i=this.$cache.splice(0,t),s=0;s<i.length;s++)this.$subComponents.push(i[s]),this.$viewManager.insertBefore(i[s].$view,this.$placeholder);for(var a=t-i.length;a--;)this.createSubComp()}var o=Util.isArray(e)?!0:!1,l=0;for(var h in e)if(e.hasOwnProperty(h)&&!(o&&isNaN(h)||0===h.indexOf("$__"))){var c=this.$subComponents[l];c[r]=e[h],c.$index=l++,n&&(c[n]=o?h>>0:h),c.init(),c.display()}},this.createSubComp=function(){var e=this.$parentComp,t=this.$viewManager.createPlaceholder("");this.$viewManager.insertBefore(t,this.$placeholder);var n=this.$__view.clone().removeAttr(this.$name),r=e.createSubComponent(n,t);return this.$subComponents.push(r),r},this.build=function(e,t,n){var r=Util.isArray(e)?!0:!1,i=0;for(var s in e)if(e.hasOwnProperty(s)&&!(r&&isNaN(s)||0===s.indexOf("$__"))){var a=this.createSubComp();a[n]=e[s],a.$index=i++,t&&(a[t]=r?s>>0:s)}for(var o=this.$subComponents.length;o--;)this.$subComponents[o].init(),this.$subComponents[o].display()},this.parseExp=function(e){var t,n,r;return e.replace(this.$eachExp,function(e,i,s){t=i;var a=s.replace(/\s/gm,""),o=a.split("=>");o.length>1?(n=o[0],r=o[1]):r=o[0]}),t?{ds:t,k:n,v:r}:void LOGGER.error("invalid each expression : "+e)}}e.directive("ignore",{$final:!0}),e.directive("bind",{onInit:function(){(!this.$params||this.$params.length<1)&&LOGGER.warn("at least one attribute be binded")},observe:function(e){if(this.$params&&!(this.$params.length<1)){var t=null;if(this.$filter){var n=this.closest(this.$filter);n&&(t=n[this.$filter])}if(t){var r=t(e);if(!Util.isUndefined(r)&&!r)return}for(var i=this.$params.length;i--;){var s=this.$params[i];this.$view.attr(s,e)}}}}),e.directive("show",{observe:function(e){e?this.$view.show():this.$view.hide()}}),e.directive("show-start",{$endTag:"show-end",onCreate:function(){this.$view.removeAttr("x-show-start"),this.__init(),this.display()},observe:function(e){e?this.$view.show():this.$view.hide()}}),e.directive("if",{onCreate:function(e){this.viewManager=e,this.placeholder=e.createPlaceholder("-- directive [if] placeholder --")},observe:function(e){if(e){if(this.$view.elements[0].parentNode)return;this.viewManager.replace(this.$view,this.placeholder)}else{if(!this.$view.elements[0].parentNode)return;this.viewManager.replace(this.placeholder,this.$view)}}},["ViewManager"]),e.directive("if-start",{$endTag:"if-end",onCreate:function(e){this.viewManager=e,this.placeholder=e.createPlaceholder("-- directive [if] placeholder --"),this.$view.removeAttr("x-if-start"),this.__init(),this.display()},observe:function(e){if(e){if(this.$view.elements[0].parentNode)return;this.viewManager.replace(this.$view,this.placeholder)}else{if(!this.$view.elements[0].parentNode)return;this.viewManager.replace(this.placeholder,this.$view)}}},["ViewManager"]),e.directive("cloak",{onCreate:function(){var e=this.$view.attr("class");return e?(e=e.replace("x-cloak",""),this.$view.attr("class",e),void t(this.$parent,this.$view.elements[0],e)):void LOGGER.warn("can not find attribute[class] of element["+this.$view.name+"] which directive[cloak] on")}}),e.directive("model",{onCreate:function(){switch(this.$view.elements[0].nodeName.toLowerCase()){case"textarea":case"input":var e=this.$view.attr("type");switch(e){case"radio":this.on("click","changeModel($event)");break;case"checkbox":this.on("click","changeModelCheck($event)");break;default:var t=null===document.body.onpropertychange?"propertychange":"input";this.on(t,"changeModel($event)")}break;case"select":this.on("change","changeModel($event)")}},changeModelCheck:function(e){var t=e.target||e.srcElement,n=t.value,r=this.$parent.data(this.$value);if(r instanceof Array||(r=[r]),t.checked)r.push(n);else{var i=r.indexOf(n);i>-1&&r.splice(i,1)}this.$parent.data(this.$value,r)},changeModel:function(e){this.$parent.data(this.$value,(e.target||e.srcElement).value)}});var r=new n;r.$final=!0,e.directive("each",r,["ViewManager"]);var i=new n;i.$endTag="each-end",e.directive("each-start",i,["ViewManager"])}(impex),"object"==typeof module&&"object"==typeof module.exports?module.exports=impex:global.impex=impex}(window||this);